{% extends 'layouts/dcf_base.html' %}
{% set active_page = "dcf_dashboard" %}
{% block title %} Dashboard {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
<title>Form 1 Dasboard</title>
<script src="/static/psalm_static/dcf_static/assets/vendor/chart.js/dist/Chart.min.js"></script>
<script src="/static/psalm_static/dcf_static/assets/vendor/chart.js/dist/Chart.extension.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<div class="header bg-primary pb-6">
	<div class="container-fluid"><center>
		<div class="header-body" style=" max-width: 95%; background-color: #007399;box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">

		<br>
				<!-- Search form -->

		<h1 class=" text-white" style="font-size:1.8em; font-weight: bold; text-align: center; margin: 2px;">FORM 1 PREPARATION, REVIEW AND APPROVAL STATUS DASHBOARD</h1>
				
				<!-- / Search form -->
			<br>
		</div></center><br><br>
			<style>
				.icon-button__badge {
					position: absolute;
					top: -10px;
					right: -10px;
					width: 25px;
					height: 25px;
					background: #ff4d4d;
					color: #ffffff;
					display: flex;
					justify-content: center;
					align-items: center;
					border-radius: 50%;
				}

				.textdesc{
					font-size:0.8em;
				}

	</style>

<div class="col-xl-12 col-md-6">
			<div class="card bg-secondary" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
			
				<!-- Card header -->
				<div class="card-header" style="background-color: #204060;">
						
				
		
		
		
		<!-- Title -->
		
		
		<h3 class="h1 mb-0 text-white"><center>DIPs</center></h3>
		
		
		
		
		
		
		
		
				</div><br>
			
				
			<div class="bg-transparent">
				<div class="row align-items-center">
			
				
				</div>
			
				</div>
				
				<!-- Card body -->
				<div class="card-body">


<div class="row">
  <div class="col-xl-5 col-md-6 mx-auto">
    <canvas id="myStackedBarChart" style="max-width: 600px; height: 500px;"></canvas>
  </div>
  <div class="col-xl-5 col-md-6 mx-auto">

    <canvas id="myPieChart" style="max-width: 600px;"></canvas>

  </div>
</div>	
<br>


<div class="row">
{% for dip in dips_list %}


<div class="col">
			<div class="card card-stats"
				style="width: 200px; border: 2px solid #006080; ">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<p class="card-title text-default mb-0"><b class="text-default font-weight-bold mb-0">RCU: {{dip}}</b></p>
							<p class=" text-mute textdesc font-weight-bold mb-0">Approved DIPs: {{dips_list[dip]["approve"]}}</p>
							<p class=" text-mute textdesc font-weight-bold mb-0">Pipeline DIPs: {{dips_list[dip]["pipeline"]}}</p>
							<p class=" text-mute textdesc font-weight-bold mb-0">Ongoing DIPs: {{dips_list[dip]["ongoing"]}}</p>
							<p class=" text-mute textdesc font-weight-bold mb-0">Not Started: {{dips_list[dip]["not_started"]}}</p>
							<p class=" text-mute textdesc font-weight-bold mb-0">Total DIPs: {{dips_list[dip]["total"]}}</p>
						</div>

					
						
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>
{% endfor %}
</div>

		
		
				</div>
			</div>
				
		
				
		</div>

<br>

<div class="col-xl-12 col-md-6">
			<div class="card bg-secondary" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
			
				<!-- Card header -->
				<div class="card-header" style="background-color: #204060;">
						
				
		
		
		
		<!-- Title -->
		
		
		<h3 class="h1 mb-0 text-white"><center>MSME</center></h3>
		
		
		
		
		
		
		
		
				</div><br>
			
				
			<div class="bg-transparent">
				<div class="row align-items-center">
			
				
				</div>
			
				</div>
				
				<!-- Card body -->
				<div class="card-body">
						
			
	<div class="row">
	<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #004d4d; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h5 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total # of Large Enterprises</b><br></h5>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1msme[0]['total_large_entep']}}</span>
						</div>

						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/large_enterprise.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
						
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>
 <div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #264d73	; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h5 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total # of Medium Enterprises</b><br></h5>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1msme2[0]['total_medium_entep']}}</span>
						</div>

						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/medium_enterprise.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
						
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>

<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #26734d; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h5 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total # of Small Enterprises</b><br></h5>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1msme3[0]['total_small_entep']}}</span>
						</div>

						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/small_enterprise.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
						
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>

<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #b30047; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h5 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total # of Micro Enterprises</b><br></h5>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1msme4[0]['total_micro_entep']}}</span>
						</div>

						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/micro_enterprise.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
						
					</div>

						

					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>
</div>




		
		
				</div>
			</div>
				
		
				
		</div>


			<br>




<div class="col-xl-12 col-md-6">
			<div class="card bg-secondary" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
			
				<!-- Card header -->
				<div class="card-header" style="background-color: #204060;">
						
				
		
		
		
		<!-- Title -->
		
		
		<h3 class="h1 mb-0 text-white"><center>Smallholder Farming Households by Sector based on approved DIPs</center></h3>
		
		
		
		
		
		
		
		
				</div><br>
			
				
			<div class="bg-transparent">
				<div class="row align-items-center">
			
				
				</div>
			
				</div>
				
				<!-- Card body -->
				<div class="card-body">
						
			


<div class="row">
	<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #2d5986; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h1 class=" card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of Male</b></h1>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1male[0]['total_male']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/man.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>

<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #2d5986; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h3 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of Male</b><br>Youth</h3>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1maleyouth[0]['total_maleyouth']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/youth.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>

<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #2d5986; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h3 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of Male</b><br>IP</h3>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1maleip[0]['total_maleip']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/male_ip.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>

<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #2d5986; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h3 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of Male</b><br>PWD</h3>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1malepwd[0]['total_malepwd']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/pwd.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>

</div><hr>
<div class="row">
	 <div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #800055; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h1 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of Female</b></h1>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1female[0]['total_female']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/female.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>

<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #800055; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h3 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of female</b><br>Youth</h3>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1femaleyouth[0]['total_femaleyouth']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/youth2.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>


<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #800055; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h3 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of Female</b><br>IP</h3>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1femaleip[0]['total_femaleip']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/female_ip.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>


<div class="col-xl-3 col-md-6">
			<div class="card card-stats h-80"
				style="height: 130px; background-color: #800055; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
				<!-- Card body -->
				<div class="card-body">
					<div class="row">
						<div class="col">
							<h3 class="card-title text-uppercase text-white mb-0"><b class="formtext">Total no. of Female</b><br>PWD</h3>
							<span class="h1 text-white font-weight-bold mb-0">{{dcf_form1femalepwd[0]['total_femalepwd']}}</span>
						</div>
						<div class="col-auto">
							<div class="icon icon-shape">
								<img src="../static/psalm_static/dcf_static/assets/img/icons/pwd.png"
									style="width: 250%; height: 250%;">
							</div>
						</div>
					</div>
					<p class="mt mb-0 text-sm">
						<br>
					</p>
				</div>

	</div>
</div>



</div>

<div class="row">
  <div class="col-xl-5 col-md-6 mx-auto">
    <!-- Chart 1 -->
    <canvas id="myChart" style="max-width: 700px; height: 700px;"></canvas>
  </div>
  <div class="col-xl-5 col-md-6 mx-auto">
    <!-- Chart 2 -->
    <canvas id="myChart2" style="max-width: 700px; height: 700px;"></canvas>
  </div>
</div>


<script >
  var xValues = [
    'Male: ' + {{dcf_form1male[0]['total_male']}},
    'Female: ' + {{dcf_form1female[0]['total_female']}},
    'Untagged: ' + money({{total_untagged}})
  ];

  var yValues = [
    {{dcf_form1male[0]['total_male']}},
    {{dcf_form1female[0]['total_female']}},
    // {{total_untagged}},
  ];
  var barColors = ['#2d5986', '#800055'];

  var total = yValues.reduce((a, b) => a + b, 0);

  var percentageValues = yValues.map((value) => ((value / total) * 100).toFixed(2));

Chart.plugins.register({
  afterDatasetsDraw: function (chart, easing) {
    // Check if the chart has the ID 'myChart'
    if (chart.canvas.id === 'myChart') {
      var ctx = chart.ctx;

      chart.data.datasets.forEach(function (dataset, i) {
        var meta = chart.getDatasetMeta(i);
        if (!meta.hidden) {
          meta.data.forEach(function (element, index) {
            ctx.fillStyle = 'white';

            var fontSize = 20; // Change this to your desired font size
            var fontStyle = 'bold';
            var fontFamily = 'sans-serif';
            ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

            // Display only the percentage value without .00
            var dataString = Number(percentageValues[index]) + '%';

            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            var padding = 5;
            var position = element.tooltipPosition();
            ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
          });
        }
      });
    }
  },
});

  new Chart('myChart', {
    type: 'pie',
    data: {
      labels: xValues,
      datasets: [
        {
          backgroundColor: barColors,
          data: yValues,
        },
      ],
    },
    options: {
      title: {
        display: true,
        text: `Overall Total Smallholder Farming Households : {{dcf_form1sextotal[0]['total_sex'] | int}}`,
        fontSize: 25,
        fontColor: 'black',
      },
      plugins: {
        datalabels: {
          display: false,
        },
      },
      legend: {
        labels: {
          fontColor: 'black', // Customize the legend label color
          fontSize: 20, // Customize the legend label font size
        },
      },
      tooltips: {
        callbacks: {
          label: function (tooltipItem, data) {
            // Display only the percentage value without .00 in the tooltip
            return data.labels[tooltipItem.index];
          },
        },
      },
    },
  });


var tooltips = [];
var xValuesbar = [];
var yValuesbar = [];
var label_ = [];
var all_perc = []
var barColorsbar = ["red", "green", "blue", "orange", "brown", "yellow", "violet", "black"];

var over_all = parseInt('{{dcf_form1sextotal[0]["total_sex"] | int}}')
{% for dip in dip_sex_group_per_region %}
    xValuesbar.push('RCU: ' + '{{dip}}');
    var rcu_total = parseInt('{{dip_sex_group_per_region[dip]["total_bene"]}}')
    // var rcu_total = parseInt('{{dip_sex_group_per_region[dip]["all_total"]["total_sex"]}}')
    var perc = ((rcu_total / over_all) * 100).toFixed(2)
    // yValuesbar.push(perc);
    all_perc.push(perc);
    yValuesbar.push(rcu_total);
    label_.push(rcu_total)

    tooltips.push([
    	'Total with sex/tagged: ' +'{{dip_sex_group_per_region[dip]["all_total"]["total_sex"]}}',
    	'Total: ' +money('{{dip_sex_group_per_region[dip]["total_bene"]|int}}'),
    	' ',
    	'Male: ' + '{{dip_sex_group_per_region[dip]["male"]["total"]}}',
    	'Youth: ' + '{{dip_sex_group_per_region[dip]["male"]["youth"]}}',
    	'IP: ' + '{{dip_sex_group_per_region[dip]["male"]["ip"]}}',
    	'PWD: ' + '{{dip_sex_group_per_region[dip]["male"]["pwd"]}}',
    	'--------------',
    	'Female: ' + '{{dip_sex_group_per_region[dip]["female"]["total"]}}',
    	'Youth: ' + '{{dip_sex_group_per_region[dip]["female"]["youth"]}}',
    	'IP: ' + '{{dip_sex_group_per_region[dip]["female"]["ip"]}}',
    	'PWD: ' + '{{dip_sex_group_per_region[dip]["female"]["pwd"]}}',
    	'--------------',
    	'Untagged: ' + '{{(dip_sex_group_per_region[dip]["total_bene"]-dip_sex_group_per_region[dip]["female"]["total"]+dip_sex_group_per_region[dip]["male"]["total"])|int}}',
    	'--------------',
    	'Overall Total',
    	'Youth: ' + '{{dip_sex_group_per_region[dip]["all_total"]["total_youth"]}}',
    	'IP: ' + '{{dip_sex_group_per_region[dip]["all_total"]["total_ip"]}}',
    	'PWD: ' + '{{dip_sex_group_per_region[dip]["all_total"]["total_pwd"]}}',
    ])
{% endfor %}

var _percentageValues = label_.map((value) => (value * 1));
// var _percentageValues = label_.map((value) => (value * over_all) / 100);

Chart.plugins.register({
  afterDatasetsDraw: function (chart, easing) {
    // Check if the chart has the ID 'myChart'
    if (chart.canvas.id === 'myChart2') {
      var ctx = chart.ctx;

      chart.data.datasets.forEach(function (dataset, i) {
        var meta = chart.getDatasetMeta(i);
        if (!meta.hidden) {
          meta.data.forEach(function (element, index) {
            ctx.fillStyle = 'gray';

            var fontSize = 14; // Change this to your desired font size
            var fontStyle = 'bold';
            var fontFamily = 'sans-serif';
            ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

            // Display only the percentage value without .00
            var dataString = Number(all_perc[index]) + '%';

            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            var padding = 5;
            var position = element.tooltipPosition();
            ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
          });
        }
      });
    }
  },
});

new Chart("myChart2", {
    type: "bar",
    data: {
        labels: xValuesbar,
        tooltip_label:tooltips,
        datasets: [{
            backgroundColor: barColorsbar,
            data: yValuesbar,
            labels : label_
        }]
    },
    options: {
        plugins: {
            datalabels: {
                color: 'black',
                display: function(context) {
                    return context.dataset.data[context.dataIndex] > 0; // Adjust the condition as needed
                },
                font: {
                    size: 14,
                    weight: 'bold'
                },
                textAlign: 'center',
                formatter: function(value, context) {
                    return value + '%';
                }
            }
        },
        legend: { display: false },
        title: {
            display: true,
            text: "Smallholder Farming Households By Region",
            fontSize: 25,
            fontColor: 'black',
            min: 100,
            padding: 20 // Adjust the value as needed for the desired margin
        },
		// tooltips: {
		// 	callbacks: {
		// 		label: function (tooltipItem, data) {
		// 		// Display only the percentage value without .00 in the tooltip
		// 			println(_percentageValues[tooltipItem.index])
		// 		return data.labels[tooltipItem.index] + ': ' + Number(_percentageValues[tooltipItem.index]);
		// 		},
		// 	},
		// },

		tooltips: {
		    callbacks: {
		        label: function (tooltipItem, data) {
		            // Display only the percentage value without .00 in the tooltip
					println(tooltipItem)

		            return data.tooltip_label[tooltipItem.index];
		        },
		    },
		    displayColors: false, // Set to false to hide the color squares in the tooltip
		},

    },
});



var xValues = [];
var approvedDips = [];
var pipelineDips = [];
var ongoingDips = [];
var notstartedDips = [];

// Assuming dips_list is a dictionary with keys as dip names
{% for dip in dips_list %}
    xValues.push('RCU: ' + '{{dip}}');
    approvedDips.push('{{dips_list[dip]["approve"]}}');
    pipelineDips.push('{{dips_list[dip]["pipeline"]}}');
    ongoingDips.push('{{dips_list[dip]["ongoing"]}}');
    notstartedDips.push('{{dips_list[dip]["not_started"]}}');
{% endfor %}

var data = {
  labels: xValues,
  datasets: [
    {
      label: 'Approved DIPs',
      backgroundColor: '#99d6ff',
      data: approvedDips
    },
    {
      label: 'In the Pipeline DIPs',
      backgroundColor: '#4db8ff',
      data: pipelineDips
    },
    {
      label: 'Ongoing Development DIPs',
      backgroundColor: '#0099ff',
      data: ongoingDips
    },
    {
      label: 'Not Started',
      backgroundColor: '#ff704d',
      data: notstartedDips
    }
  ]
};

// Set the minimum value as suggestedMin for the y-axis
var options = {
  scales: {
    x: {
      stacked: true
    },
    y: {
      stacked: true,
      ticks: {
        beginAtZero: true
      }
    }
  },
     title: {
        display: true,
        text: `DIPs by Region`,
        fontSize: 15,
        fontColor: '#204060',
      }
};

// Get the context of the canvas element
var ctx = document.getElementById('myStackedBarChart').getContext('2d');

// Create the stacked bar chart
var myStackedBarChart = new Chart(ctx, {
  type: 'bar',
  data: data,
  options: options
});

// Custom label drawing after datasets are drawn




var _labels = [];
var _data = [];

// Sample data
{% for key in over_all_commodity_count %}
  _labels.push('{{key}}');
  _data.push('{{over_all_commodity_count[key]}}');
{% endfor %}

// Calculate total for _data
var totalData = _data.reduce((a, b) => parseFloat(a) + parseFloat(b), 0);

// Normalize _data to make its total equivalent to totalData
var normalizedData = _data.map(value => ((parseFloat(value) / totalData) * 100).toFixed(2));

var data = {
  labels: _labels,
  datasets: [{
    data: normalizedData, // Values for each category
    backgroundColor: ['#5c5c3d', '#994d00', '#1a0d00', '#a6a6a6', '#006666'],
  }]
};

var options = {
  responsive: true,
  maintainAspectRatio: false,
  tooltips: {
    callbacks: {
      label: function (tooltipItem, data) {
        var label = data.labels[tooltipItem.index];
        var value = _data[tooltipItem.index];
        return label + ': ' + value;
      },
    },
  },
   title: {
        display: true,
        text: `DIPs by Commodity`,
        fontSize: 15,
        fontColor: '#204060',
      }
};

var ctx = document.getElementById('myPieChart').getContext('2d');
var myPieChart = new Chart(ctx, {
  type: 'pie',
  data: data,
  options: options,
  title: 'Commodity'
});

// Display total percentage values on the pie chart
Chart.plugins.register({
  afterDatasetsDraw: function (chart, easing) {
    if (chart.canvas.id === 'myPieChart') {
      var ctx = chart.ctx;

      chart.data.datasets.forEach(function (dataset, i) {
        var meta = chart.getDatasetMeta(i);
        if (!meta.hidden) {
          meta.data.forEach(function (element, index) {
            ctx.fillStyle = 'white';

            var fontSize = 12;
            var fontStyle = 'bold';
            var fontFamily = 'sans-serif';
            ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

            var dataString = normalizedData[index] + '%';

            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            var padding = 5;
            var position = element.tooltipPosition();
            ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
          });
        }
      });
    }
  },
});
</script>



		
		
				</div>
			</div>
				
		
				
		</div>


 




			<!-- Card header -->
			<div class="d-flex justify-content-center">
				<div class="table-responsive table py-4 mx-auto" style="max-width: 100%;">
					<div id="datatable-buttons_wrapper" class=" text-dark dataTables_wrapper dt-bootstrap4">
						<table class="table table-dark table-flush dataTable " id="datatable-buttons" role="grid"
							aria-describedby="datatable-buttons_info" style="width:100% !important">
							<thead class="thead">
								<tr role="row">
									<th>ID</th>
									<th>RCUs</th>
									<th>Scope/Provinces</th>
									<th>Commodity</th>
									<th>Action</th>
									<th>Timestamp</th>
								</tr>
							</thead>

							<tbody>
								<tr>
									<div>
										{% for row in form1_datatable %}
										<td>{{ row['id'] }}</td>
										<td>{{ row['form_1_rcus'] }}</td>
										<td>{{ row['form_1_scope_provinces'] }}</td>
										<td>{{ row['form_1_commodity'] }} {{ row['form_1_commodity_others'] }}</td>
										<td>
											<!-- {{row['upload_by']}} === {{user_data['id']}} -->
								

											{% if row['upload_by']|string == user_data['id']|string %}
											<a style="color: #00FFAB;" href="/dcf/form1?id={{ row['id'] }}&table=dcf_prep_review_aprv_status">
												<span><i class="fa-solid fa-pen-to-square"></i></span> Edit
											</a> &nbsp;&nbsp;&nbsp;&nbsp;
											<a style="color: #ff4d4d;" onclick="showDeleteConfirmation('{{ row['id'] }}'); return false;"
												href="/delete_record/dcf_prep_review_aprv_status/{{ row['id'] }}">
												<span><i class="fa-solid fa-trash"></i></span> Delete
											</a>
											{% elif user_data['job'] == "Super Admin" %}
											<a style="color: #1ac6ff;" href="/dcf/form1?id={{ row['id'] }}&table=dcf_prep_review_aprv_status">
												<span><i class="fa fa-eye" aria-hidden="true"></i></span> View
											</a>
											{% else %}
											<a style="color: #1ac6ff;" href="/dcf/form1?id={{ row['id'] }}&table=dcf_prep_review_aprv_status">
												<span><i class="fa fa-eye" aria-hidden="true"></i></span> View
											</a>
											{% endif %}

										</td>
										<td class="date-cell"> {{ row['date_created'] }}<br>
											{% if row['date_modified'] %}
											<i style="font-size: smaller;color: #00cc66;">Updated: {{ row['date_modified'] | format_timestamp
												}}</i>
											{% endif %}</i>
										</td>


								</tr>

								{% endfor %}
							</tbody>
						</table>

					</div>



				</div>

			</div>


			<div class="py-4">
				<div class="dropdown">
					<button class="btn btn-default d-inline-flex align-items-center me-2"
						onclick="window.open('/dcf/form1', '_blank')">
						<i class="fa-solid fa-arrow-up-right-from-square"></i>
						&nbsp; GO TO PREPARATION, REVIEW AND APPROVAL STATUS FORM
					</button>
				</div>
			</div>
			{% include "includes/form_spreadsheet/form1spreadsheet.html" %}

			<!-- Page content -->


		</div>
	</div>
</div>








<script>

	$('.value').each(function() {
	var text = $(this).text();
	$(this).parent().css('width', text);
});


	function showDeleteConfirmation(id) {
								swalWithCustomButtons.fire({
									title: 'Are you sure?',
									text: "You won't be able to revert this!",
									icon: 'warning',
									showCancelButton: true,
									confirmButtonText: 'Yes, delete it!',
									cancelButtonText: 'No, cancel',
									reverseButtons: true,
									customClass: {
										confirmButton: 'btn btn-success',
										cancelButton: 'btn btn-danger',
									},
								}).then((result) => {
									if (result.isConfirmed) {
										window.location.href = `/delete_record/dcf_prep_review_aprv_status/${id}`;
									} else if (result.dismiss === Swal.DismissReason.cancel) {
										swalWithCustomButtons.fire(
											'Cancelled',
											'Your record is safe',
											'error'
										);
									}
								});

								// Prevent the default link behavior
								return false;
							}

							const swalWithCustomButtons = Swal.mixin({
								customClass: {
									confirmButton: 'btn btn-success',
									cancelButton: 'btn btn-danger'
								},
								buttonsStyling: false
							});


</script>


{% endblock content %}

<!-- Specific JS goes HERE -->

{% block javascripts %}



{% endblock javascripts %}