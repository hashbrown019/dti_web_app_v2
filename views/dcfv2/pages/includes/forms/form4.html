{% extends 'layouts/dcf_base.html' %}
{% set active_page = "form4" %}
{% set forms = "forms" %}
{% block title %} Dashboard {% endblock title %}

<!-- Specific CSS goes HERE -->
<link href="https://fonts.googleapis.com/css?family=Quicksand:300,500" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
	integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
<title>Form 4</title>
	{% include "includes/sweetalert.html" %}
	<div class="right_col" role="main">
		<div class="row">
	<div class="col-md-12 col-sm-12 x-card  x-light-grey">

		<center>
			<h2 class=" x-container x-padding text-white" style="background-color: #007399;">FORM 4 - CAPACITY BUILDING FOR BENEFICIARIES</h2>
			<span class="badge" style=" background-color: #334257; color: #ffb366;" id="head_note"></span>
			<h2 class=" x-container x-padding text-black"><i class="fa fa-info-circle"> </i> For one activity with participants from multiple Detailed Investment Plans (DIPs), create separate entries for each DIP. 
				Please ensure that both entries have the same <strong>Activity Title</strong> and <strong>Activity Date</strong> (with same  formatting) to allow the system to count the entries as one activity.</h2>
		</center>

		<div class="x-container x-padding">
			<style>
				table,
				th,
				td {
					border: 1px solid black;
					border-collapse: collapse;
				}
			</style>
				<input class="FORM4_FIELD x-input" type="hidden"  id="id">


			<!---1--->
			<div class="x-row x-container x-padding">
				<div class="x-col l3 x-container x-padding">
					<label class="">Implementing Unit:</label>
					<select class="FORM4_FIELD x-border x-select x-border" id="cbb_implementing_unit"
						name="cbb_implementing_unit" required>
						<option value="">Choose your option</option>
						<optgroup label="RCU">
							<option value="8">Region Vlll - Eastern Visayas</option>
							<option value="9">Region lX - Zamboanga Peninsula</option>
							<option value="10">Region X - Northern Mindanao</option>
							<option value="11">Region Xl - Davao Region</option>
							<option value="12">Region Xll - SOCCSKSARGEN</option>
							<option value="13">Region Xlll - Caraga</option>
							<option value="BARMM">BARMM</option>
						</optgroup>
						<optgroup label="PCU">

							<option>Northern Samar</option>
							<option>Leyte</option>
							<option>Southern Leyte</option>
							<option>Zamboanga del Norte</option>
							<option>Zamboanga Sibugay</option>
							<option>Zamboanga del Sur</option>
							<option>Misamis Oriental</option>
							<option>Bukidnon</option>
							<option>Lanao del Norte</option>
							<option>Davao de Oro</option>
							<option>Davao Oriental</option>
							<option>Davao del Norte</option>
							<option>Davao del Sur</option>
							<option>Davao Occidental</option>
							<option>North Cotabato</option>
							<option>Sultan Kudarat</option>
							<option>Sarangani</option>
							<option>Agusan del Norte</option>
							<option>Agusan del Sur</option>
							<option>Surigao del Sur</option>
							<option>Maguindanao</option>
						</optgroup>
						<option style="font-weight: bold;">NGA Partners</option>
					</select>
				</div>

				<!-- <div class="x-col l3 x-container">
					<label>Training Number</label>
					<input class="FORM4_FIELD x-input x-border" name="cbb_training_number" id="cbb_training_number" type="text" placeholder="">
				</div> -->
				<div class="x-col l3 x-padding x-container">
					<label><span style="color: #007399;" class="tool" data-tip="Provide full activity title based on approved activity proposal." tabindex="1"><i class="fa fa-info-circle"></i></span> Activity Title:</label>
					<input class="FORM4_FIELD x-input x-border" name="cbb_activity_title" id="cbb_activity_title"
						type="text" placeholder="">
				</div>
				<div class="x-col l6 x-container x-padding">
					<label class="">Types of Training:</label>
					<div id="cbb_types_of_training" class="dropdown-check-list FORM4_FIELD" tabindex="100">
					  <span class="anchor">Choose your option</span>
					  <ul class="items">

						<li><strong>Farmer Organizations</strong></li>
						<li><input type="checkbox" value="FO-Organization Entrepreneurial Competency" /> Organization Entrepreneurial Competency</li>
						<li><input type="checkbox" value="FO-Governance" /> Governance</li>
						<li><input type="checkbox" value="FO-Organizational Management" /> Organizational Management</li>
						<li><input type="checkbox" value="FO-Operations" /> Operations</li>
						<li><input type="checkbox" value="FO-Technology and Product Development" /> Technology and Product Development (Business Development)</li>
						<li><input type="checkbox" value="FO-Institutional Marketing Management" /> Institutional Marketing Management</li>
						<li><input type="checkbox" value="FO-Human Resource Management" /> Human Resource Management</li>
						<li><input type="checkbox" value="FO-Financial Management" /> Financial Management</li>
						<li><input type="checkbox" value="FO-Networking and Linkage-Building" /> Networking and Linkage-Building (External Relations, Business Membership Organization)</li>
						<li><input type="checkbox" value="FO-GESI" /> GESI</li>
						<li><input type="checkbox" value="FO-Social Environment & Climate" /> Social Environment & Climate</li>
						<li><input type="checkbox" value="FO-Managing Natural Resources" /> Managing Natural Resources</li>
				  
						<li><strong>MSME</strong></li>
						<li><input type="checkbox" value="MSME-Entrepreneurial Competency" /> Entrepreneurial Competency</li>
						<li><input type="checkbox" value="MSME-Operations" /> Operations</li>
						<li><input type="checkbox" value="MSME-Management" /> Management</li>
						<li><input type="checkbox" value="MSME-Agricultural Production" />  Agricultural Production</li>
						<li><input type="checkbox" value="MSME-Technology and Product Development" /> Technology and Product Development</li>
						<li><input type="checkbox" value="MSME-Marketing Management" /> Marketing Management</li>
						<li><input type="checkbox" value="MSME-Human Resource Management" /> Human Resource Management</li>
						<li><input type="checkbox" value="MSME-Financial Management" /> Financial Management</li>
						<li><input type="checkbox" value="MSME-Networking and Linkage-Building" /> Networking and Linkage-Building (External Relations, Business Membership Organization)</li>
						<li><input type="checkbox" value="MSME-GESI" /> GESI</li>
						<li><input type="checkbox" value="MSME-Social Environment & Climate" /> Social Environment & Climate</li>
						<li><input type="checkbox" value="MSME-Managing Natural Resources" /> Managing Natural Resources</li>
				  
						<li><strong>Individual Farmer</strong></li>
						<li><input type="checkbox" value="Individual Farmer-Managing Natural Resources" /> Managing Natural Resources</li>
						<li><input type="checkbox" value="Individual Farmer-Agricultural Production" />  Agricultural Production</li>
						<li><input type="checkbox" value="Individual Farmer-Managing Finances" /> Managing Finances</li>
						<li><input type="checkbox" value="Individual Farmer-Marketing" /> Marketing</li>
						<li><input type="checkbox" value="Individual Farmer-Innovation" /> Innovation</li>
						<li><input type="checkbox" value="Individual Farmer-Teamwork" /> Teamwork</li>
						<li><input type="checkbox" value="Individual Farmer-GESI" /> GESI</li>
						<li><input type="checkbox" value="Individual Farmer-Social Environment & Climate" /> Social Environment & Climate</li>
					  </ul>
					</div>
					<input type="hidden" name="cbb_types_of_training" id="cbb_types_of_training" />
				  </div>
				
				  <script>
					document.addEventListener("DOMContentLoaded", function () {
						var checkList = document.getElementById('cbb_types_of_training');
						var anchor = checkList.querySelector('.anchor');
						var checkboxes = checkList.querySelectorAll("input[type='checkbox']");
						var hiddenInput = document.getElementById('cbb_types_of_training');
				
						// Toggle dropdown visibility
						anchor.addEventListener("click", function (event) {
							checkList.classList.toggle('visible');
							event.stopPropagation();
						});
						// Close dropdown when clicking outside
						document.addEventListener("click", function (event) {
							if (!checkList.contains(event.target)) {
								checkList.classList.remove('visible');
							}
						});
				
						// Function to update dropdown text and hidden input
						function updateDropdownText() {
							let selected = [];
							checkboxes.forEach(function (checkbox) {
								if (checkbox.checked) {
									selected.push(checkbox.value);
								}
							});
							anchor.textContent = selected.length > 0 ? selected.join(", ") : "Choose your option";
							hiddenInput.value = selected.join(", "); // Store values in hidden input
						}
				
						// Preselect checkboxes if hidden input has values
						function preselectCheckboxes() {
							let storedValues = hiddenInput.value.split(", "); // Get saved values
							checkboxes.forEach(function (checkbox) {
								if (storedValues.includes(checkbox.value)) {
									checkbox.checked = true;
								}
							});
							updateDropdownText(); // Update UI based on selection
						}
				
						// Event listeners for checkboxes
						checkboxes.forEach(function (checkbox) {
						checkbox.addEventListener("change", updateDropdownText);
						});
				
						// Call preselection on page load
						preselectCheckboxes();
					});
				</script>	
				
					
					<style>
						.dropdown-check-list {
							display: inline-block;
							position: relative;
							width: 100%;
						}
						.dropdown-check-list .anchor {
							position: relative;
							cursor: pointer;
							display: block;
							padding: 10px;
							border: 1px solid #ccc;
							background-color: white;
							width: 100%;
							min-height: 30px;
							text-overflow: ellipsis;
							white-space: nowrap;
							overflow: hidden;
						}
						.dropdown-check-list .anchor:after {
							position: absolute;
							content: "";
							border-left: 2px solid black;
							border-top: 2px solid black;
							padding: 5px;
							right: 10px;
							top: 50%;
							transform: translateY(-50%) rotate(-135deg);
						}	
						.dropdown-check-list .items {
							display: none;
							position: absolute;
							background: white;
							width: 100%;
							border: 1px solid #ccc;
							max-height: 200px;
							overflow-y: auto;
							z-index: 1000;
							padding: 5px;
						}						
						.dropdown-check-list .items li {
							list-style: none;
							padding: 5px;
						}						
						.dropdown-check-list .items li strong {
							display: block;
							padding: 5px;
							background-color: #f2f2f2;
							font-weight: bold;
						}						
						.dropdown-check-list.visible .items {
							display: block;
						}
					</style>	
			</div>

			<!---2--->
			<div class="x-row x-padding x-container">
				<div class="x-col l4 x-container x-padding">
					<label>Topic Of Training: <span style="color: #007399;" class="tool" data-tip="Choose topic of training in options (you can select multiple). If you select 'GESI,' 'Social Environment & Climate,' or 'Managing Natural Resources' in Types of Training, you can type the topic of training and press 'Enter' ." tabindex="1"><i class="fa fa-info-circle"></i></span>  </label>
						<!-- <input type="text" id="cbb_topic_of_training" name="cbb_topic_of_training[]" multiple> -->
						<select class="FORM4_FIELD" id="cbb_topic_of_training" name="cbb_topic_of_training[]" multiple></select>
				</div>
				<div class="x-col l4 x-container x-padding">
					<label class="">DIP-approved alignment:</label>
					<select class="FORM4_FIELD x-border x-select x-border" name="cbb_dip_approved_alignment"
						id="cbb_dip_approved_alignment">
						<option value="">Choose your option</option>
						<option>Conducted before DIP approval</option>
						<option>Conducted after DIP approval</option>
						<option>N/A</option>
					</select>
				</div>

				<div class="x-col l4 x-container x-padding">
					<label>
						<span style="color: #007399;" class="tool" data-tip="DIP name format: Region<space>DIP Name (ex. R8 SC Global)." tabindex="1">
							<i class="fa fa-info-circle"></i>
						</span> 
						Name of DIPs:
					</label>
					<select class="FORM4_FIELD x-input x-border" name="cbb_name_of_dip" id="cbb_name_of_dip">
						<option value="">Choose your option</option>
					</select>
				</div>
				<script>
					function populateDipNames() {
						return fetch('/api/get_dip_names')
							.then(response => {
								if (!response.ok) {
									return response.text().then(text => { throw new Error(text) });
								}
								return response.json();
							})
							.then(data => {
								const selectElement = document.getElementById('cbb_name_of_dip');
								// Clear existing options to prevent duplication
								selectElement.innerHTML = '<option value="">Choose your option</option>';
								data.forEach(item => {
									const option = document.createElement('option');
									option.value = item.form_1_name_dip;
									option.textContent = item.form_1_name_dip;
									selectElement.appendChild(option);
								});
							})
							.catch(error => console.error('Error fetching DIP names:', error));
					}
					// Wait for the full page load before executing the script
					populateDipNames().then(() => {
						var record_id = URL_ARGS["id"];
						var table = URL_ARGS["table"];
						load_data(record_id, table, "FORM4_FIELD");
						get_participants_data(record_id, table, "FORM4_FIELD");
					});
				</script>
			</div>

			<!---3--->
			<div class="x-row x-container x-padding">
				<div class="x-col l5 x-container x-padding">
					<style>
						table,
						th,
						td {
							border: 1px solid black;
							border-collapse: collapse;
						}
					</style>
					<table class="x-table x-container x-table-border">
						<tr>
							<th colspan="2">
								<center>ACTIVITY DURATION<br>(Day, Month, Year)</center>
							</th>
						</tr>
						<tr>
							<td>
								<center>Start Date</center>
							</td>
							<td>
								<center>End Date</center>
							</td>
						</tr>
						<tr>
							<td><input class="FORM4_FIELD x-input x-border" name="cbb_date_start" id="cbb_date_start" type="date" placeholder=""></td>
							<td><input class="FORM4_FIELD x-input x-border" name="cbb_date_end" id="cbb_date_end" type="date" placeholder=""></td>
						</tr>
					</table>
				</div>

				<!-- <div class="x-col l4 x-container x-padding">
					<label>Total Number of Participants:</label>
					<input class="FORM4_FIELD x-input x-border" name="cbb_total_number_of_participants"
						id="cbb_total_number_of_participants" type="Number" placeholder="Input Number">
				</div> -->

				<div class="x-col l3 x-container x-padding">
					<label class="">Commodity:</label>
					<div id="cbb_commodity" class="dropdown-check-list FORM4_FIELD" tabindex="100">
						<span class="anchor">Choose your option</span>
						<ul class="items">
							<li><input type="checkbox" value="Coffee" /> Coffee</li>
							<li><input type="checkbox" value="Cacao" /> Cacao</li>
							<li><input type="checkbox" value="Coconut" /> Coconut</li>
							<li><input type="checkbox" value="PFN" /> PFN</li>
						</ul>
					</div>
					<input type="hidden" name="cbb_commodity" id="cbb_commodity" />
				</div>
				
				<script>
					document.addEventListener("DOMContentLoaded", function () {
						var checkList = document.getElementById('cbb_commodity');
						var anchor = checkList.querySelector('.anchor');
						var checkboxes = checkList.querySelectorAll("input[type='checkbox']");
						var hiddenInput = document.getElementById('cbb_commodity');
				
						// Toggle dropdown visibility
						anchor.addEventListener("click", function (event) {
							checkList.classList.toggle('visible');
							event.stopPropagation();
						});
						// Close dropdown when clicking outside
						document.addEventListener("click", function (event) {
							if (!checkList.contains(event.target)) {
								checkList.classList.remove('visible');
							}
						});
				
						// Function to update dropdown text and hidden input
						function updateDropdownText() {
							let selected = [];
							checkboxes.forEach(function (checkbox) {
								if (checkbox.checked) {
									selected.push(checkbox.value);
								}
							});
							anchor.textContent = selected.length > 0 ? selected.join(", ") : "Choose your option";
							hiddenInput.value = selected.join(", "); // Store values in hidden input
						}
				
						// Preselect checkboxes if hidden input has values
						function preselectCheckboxes() {
							let storedValues = hiddenInput.value.split(", "); // Get saved values
							checkboxes.forEach(function (checkbox) {
								if (storedValues.includes(checkbox.value)) {
									checkbox.checked = true;
								}
							});
							updateDropdownText(); // Update UI based on selection
						}
				
						// Event listeners for checkboxes
						checkboxes.forEach(function (checkbox) {
						checkbox.addEventListener("change", updateDropdownText);
						});
			
						// Call preselection on page load
						preselectCheckboxes();
					});
				</script>				
				

				<div class="x-row x-container x-padding">
					<style>
						table,
						th,
						td {
							border: 1px solid black;
							border-collapse: collapse;
						}
					</style>
					<table id="form4_table" class="x-table x-container x-table-border">
							<tr>
								<th>
									<center>
										<button type="button" style="float: left;" class="btn btn-primary"
										onclick="add_row()"><i
										class="fa fa-plus-circle"></i>&nbsp;&nbsp;Add</button>Venue
										<button type="button" class="btn btn-danger" style="float: right;" onclick="delete_row()"><i class="fa fa-trash"></i>&nbsp;&nbsp;Remove Empty Row</button>
									</center>
								</th>
								<th>
									<center>Name of Resource Person/Facilitator/BDSP<br>(First Name, Middle Name, Last Name)</center>
								</th>
							</tr>
						
							<tr id="main_row">
								<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_venue_kapown_0" 
									type="text" name="cbb_venue[]"></td>
								<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_name_of_resource_person_kapown_0"
									type="text" name="cbb_name_of_resource_person[]"></td>
							</tr>
					</table>
				</div>
				<script>
					let og_row = $ID('main_row').parentNode.innerHTML
					var form4_table = document.getElementById("form4_table");
					var k_counter = 1
							function add_row() {
								// $ID('main_').innerHTML += og_row
								// Create an empty <tr> element and add it to the 1st position of the form3_table_org_comp:
								var row = form4_table.insertRow(1);
						
								// Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
								row.insertCell(0).innerHTML = `<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_venue_kapown_`+k_counter+`" type="text" name="cbb_venue[]"></td>`
								row.insertCell(1).innerHTML = `<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_name_of_resource_person_kapown_`+k_counter+`" type="text" name="cbb_name_of_resource_person[]"></td>`
								k_counter += 1
								// Add some text to the new cells:
					}


						function delete_row() {
						var rows = form4_table.rows; // Get all rows in the table
						var emptyRowFound = false;

						// Loop through the rows to find and delete empty rows first
						for (var i = 1; i < rows.length; i++) { // Start from 1 to skip the header row
							var venueInput = rows[i].querySelector("input[name='cbb_venue[]']");
							var resourcePersonInput = rows[i].querySelector("input[name='cbb_name_of_resource_person[]']");

							// Check if both inputs are empty
							if (venueInput && resourcePersonInput && venueInput.value.trim() === "" && resourcePersonInput.value.trim() === "") {
								form4_table.deleteRow(i);
								emptyRowFound = true;
								break; // Stop after deleting the first empty row
							}
						}

						// If no empty rows are found, do not delete rows with any data
						if (!emptyRowFound) {
							alert("Cannot delete rows with data. Please clear the row before deleting.");
						}
					}
				</script>

				<div class="x-row x-container x-padding">
					<style>
						table,
						th,
						td {
							border: 1px solid black;
							border-collapse: collapse;
						}
					</style>
					<table class="x-table x-container x-table-border">
						<tr>
						<th>
							<center><span style="color: #007399;" class="tool" data-tip="Enter amount utilized for the conduct of activities without comma (ex. 500000)." tabindex="1"><i class="fa fa-info-circle"></i></span> RAPID Actual Budget</center>
						</th>
						<th colspan="2">
							<center>DIP Capbuild Activities fully & partially funded by partners outside RAPID</center>
						</th>
						</tr>

						<td>
							<center>Actual</center>
						</td>
						<td>
							<center>Name of Partner/Organization</center>
						</td>
						<td>
							<center>Counterpart Amount<br>(monetize & estimates)</center>
						</td>

						<tr>
							<td><input class="FORM4_FIELD x-light-grey x-input" name="cbb_rapid_actual_budget"
									id="cbb_rapid_actual_budget" type="text"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" name="cbb_dip_capbuild_activities_NPO"
									id="cbb_dip_capbuild_activities_NPO" type="text"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" name="cbb_dip_capbuild_activities_CA"
									id="cbb_dip_capbuild_activities_CA" type="text"></td>
						</tr>
					</table>
				</div>

				<!-- <div class="x-col l5 x-container x-padding">
					<label class="">Type of Beneficiaries</label>
					<select class="FORM4_FIELD x-border x-select x-border" id="cbb_total_number_of_beneficiaries_per_type" name="cbb_total_number_of_beneficiaries_per_type"><br>
						<option value="">Choose your option</option>
						<option>MSME</option>
						<option>FO</option>
						<option>FARMER</option>
					</select>
				</div> -->

				<div class="x-container x-padding">
					<style>
						table,
						th,
						td {
							border: 1px solid black;
							border-collapse: collapse;
						}
					</style>
					<table class="x-table x-container x-table-border">
						<tr>
							<th colspan="3">
								<center>Total Number Per Sex</center>
							</th>
							<th colspan="5">
								<center>Total Number Per Sector</center>
							</th>
						</tr>

						<tr>
							<!---gender---->
							<td>
								<center>male</center>
							</td>
							<td>
								<center>female</center>
							</td>
							<td>
								<center>total</center>
							</td>
							<!---sector---->
							<td>
								<center>PWD</center>
							</td>
							<td>
								<center>Youth</center>
							</td>
							<td>
								<center>IP</center>
							</td>
							<td>
								<center>SC</center>
							</td>
							<td>
								<center>Total</center>
							</td>
						</tr>

						<tr>
							<!---gender--->
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_total_number_per_gender_male"type="number" name="cbb_total_number_per_gender_male"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_total_number_per_gender_female"type="number" name="cbb_total_number_per_gender_female"></td>
							<td><input readonly class="FORM4_FIELD x-input" id="cbb_total_number_per_gender_total"type="text" name="cbb_total_number_per_gender_total"></td>
							<!--sector--->
							<td><input readonly  class="FORM4_FIELD  x-input" id="cbb_total_number_per_sector_pwd"type="number" name="cbb_total_number_per_sector_pwd"></td>
							<td><input readonly class="FORM4_FIELD  x-input" id="cbb_total_number_per_sector_youth"type="number" name="cbb_total_number_per_sector_youth"></td>
							<td><input readonly class="FORM4_FIELD  x-input" id="cbb_total_number_per_sector_ip"type="number" name="cbb_total_number_per_sector_ip"></td>
							<td><input readonly class="FORM4_FIELD  x-input" id="cbb_total_number_per_sector_sc"type="number" name="cbb_total_number_per_sector_sc"></td>
							<td><input readonly class="FORM4_FIELD  x-input" id="cbb_total_number_per_sector_total"type="text" name="cbb_total_number_per_sector_total"></td>
						</tr>
					</table>
				</div>

				<div class="x-container x-padding">
					<style>
						table,
						th,
						td {
							border: 1px solid black;
							border-collapse: collapse;
						}
					</style>
					<table class="x-table x-container x-table-border">
						<tr>
							<th colspan="6">
								<center>Participants by sex per sector</center>
							</th>
						</tr>

						<tr>
							<td>
								<center>Sex</center>
							</td>
							<td>
								<center>IP</center>
							</td>
							<td>
								<center>Youth</center>
							</td>
							<td>
								<center>PWD</center>
							</td>
							<td>
								<center>SC</center>
							</td>
							<td>
								<center>Total</center>
							</td>
						</tr>

						<tr>
							<td><center>Male</center></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_male_ip"
								type="number" name="cbb_male_ip"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_male_youth"
								type="number" name="cbb_male_youth"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_male_pwd" 
								type="number" name="cbb_male_pwd"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_male_sc" 
								type="number" name="cbb_male_sc"></td>
							<td><input readonly class="FORM4_FIELD x-input" id="cbb_male_total" 
								type="number"name="cbb_male_total"></td>
						</tr>

						<tr>
							<td><center>Female</center></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_female_ip"
								type="number" name="cbb_female_ip"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_female_youth"
								type="number" name="cbb_female_youth"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_female_pwd" 
								type="number" name="cbb_female_pwd"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_female_sc" 
								type="number" name="cbb_female_sc"></td>
							<td><input readonly class="FORM4_FIELD  x-input" id="cbb_female_total" 
								type="number"name="cbb_female_total"></td>
						</tr>
					</table>
				</div>

				<div class="x-container x-padding">
					<style>
						table,
						th,
						td {
							border: 1px solid black;
							border-collapse: collapse;
						}
					</style>
					<table class="x-table x-container x-table-border">
						<tr>
							<th colspan="2">
								<center>Results of activity (Average)</center>
							</th>
							<th colspan="2">
								<center>Client Feedback Survey </center>
							</th>
						</tr>

						<tr>
							<td>
								<center>Pre-Test</center>
							</td>
							<td>
								<center>Post-Test</center>
							</td>
							<td>
								<center>Average Rating</center>
							</td>
							<td>
								<center>Comments/ Areas of Improvement</center>
							</td>
						</tr>

						<tr>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_results_of_activity_pre_test"
									type="text" name="cbb_results_of_activity_pre_test"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_results_of_activity_post_test"
									type="text" name="cbb_results_of_activity_post_test"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_client_feedback_survey_rating"
									type="text" name="cbb_client_feedback_survey_rating"></td>
							<td><input class="FORM4_FIELD x-light-grey x-input" id="cbb_client_feedback_survey_comments_AOI" 
									type="text" name="cbb_client_feedback_survey_comments_AOI"></td>
						</tr>
					</table>
				</div>

<!-- Start to do list -->
{% if benef|length !=0 %}
<div class="col-md-12 col-sm-12 ">
	<div class="x_panel">
	  <div class="x_title">
		<h2>Participants &nbsp;&nbsp;&nbsp;
				<a style="color: #339966;  cursor: pointer;" onclick='goto("/feature_0/link_data_dcf_form_a?&h="+URL_ARGS["id"]+"&i="+URL_ARGS["table"],true)'>
				<span><i class="fa fa-pencil-square-o" style="color:#339966;"></i></span> Edit Participants</a> </h2>
			<ul class="nav navbar-right panel_toolbox">
				<li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
						<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
							<a class="dropdown-item" href="#">Settings 1</a>
							<a class="dropdown-item" href="#">Settings 2</a>
						</div>
					</li>
				<li><a class="close-link"><i class="fa fa-close"></i></a></li>
			</ul>
		<div class="clearfix"></div>
	</div>
<div class="x_content">
  <div class="row">
	  <div class="col-sm-12">
		<div class="card-box table-responsive">
			<p class=" text-muted font-13 m-b-30">
			  Farmer's Profile/ Participants/ Beneficiaries/ FO/ MSMEs/ DCF's</p>
		  			<table id="datatable-responsive" class="table table-dark table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
						<thead>
						<tr>
							<th>Name / Org Name</th>
							<th>Sex</th>
							<th>Birthday</th>
							<th>Primary Crop (If Applicable)</th>
							<th>Barangay</th>
							<th>City/Municipality</th>
							<th>Province</th>
							<th>Region</th>
						</tr>
						</thead>
						<tbody>
								{% for parti in benef%}
							<tr>
								<td>{{parti['fname']}}</td>
								<td>{{parti['sex']}}</td>
								<td>{{parti['farmer_bday']}}</td>
								<td>{{parti['farmer_primary_crop']}}</td>
								<td>{{parti['addr_brgy']}}</td>
								<td>{{parti['addr_city']}}</td>
								<td>{{parti['addr_prov']}}</td>
								<td>Region {{parti['addr_region']}}</td>
							</tr>
								{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
{% endif%}


		<div class="x-row x-container x-padding" hidden>
			<div class="x-col l3 x-container x-padding">
					<label for="avatar">Choose MOVs:</label>
					<input type="file" id="cbb_avatar" name="avatar" accept="image/png, image/jpeg, video/mp4">
			</div>
			<!-- <div class="x-col l4 x-container x-padding">
				<button data-toggle="modal" data-target="#form4_modalpart" onclick="window.open('/feature_0/link_data_dcf_form_a?i='+URL_ARGS['table']+'&h='+URL_ARGS['id'])"
				style="box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;" type="button" id="btnpart"
				class="x-teal btn"><i class="fa-solid fa-user-plus"></i>&nbsp;&nbsp;Add
				Participants</button>
			</div> -->
		</div>
				<p class="x-right" id="submit_btn_holder">
					<button class="btn btn-primary" type="button" onclick="submit_form('FORM4_FIELD','dcf_capacity_building','/form4_dashboard')">Submit</button>
				</p>
			</div>
		</div>
	</div>
			{% include 'formdata_handler.html' %}

		
	<script>
		$onload(function () {
		var record_id = URL_ARGS["id"]
		var table = URL_ARGS["table"]
		load_data(record_id, table, "FORM4_FIELD")
		get_participants_data(record_id, table, "FORM4_FIELD")
		// submit_form('CLASSNAME_FOR_FIELDS','TABLE_NAME','URL_DASH',)
		})
		function changecbb_types_of_training(val_){
	
		var dyn_choices ={
			"FO-Organization Entrepreneurial Competency" : [
				{ value: 'Formulating strategies', label: 'Formulating strategies', },
				{ value: 'Identifying business opportunities', label: 'Identifying business opportunities', },
				{ value: 'Business networking', label: 'Business networking' },
				{ value: 'Innovation', label: 'Innovation' },
			],
			"FO-Governance" : [
				{ value: 'Democratic elections', label: 'Democratic elections', },
				{ value: 'Group decision-making', label: 'Group decision-making', },
				{ value: 'Formulating internal policies', label: 'Formulating internal policies' },
				{ value: 'Establishing organizational structure', label: 'Establishing organizational structure' },

			],
			"FO-Organizational Management" : [
				{ value: 'Identifying competitive advantage', label: 'Identifying competitive advantage', },
				{ value: 'Recording transactions', label: 'Recording transactions', },
				{ value: 'Complying with government regulations', label: 'Complying with government regulations' },
			],
			"FO-Operations" : [
				{ value: 'Meeting quality specifications', label: 'Meeting quality specifications', },
				{ value: 'Meeting volume requirements', label: 'Meeting volume requirements', },
				{ value: 'Meeting delivery commitments', label: 'Meeting delivery commitments' },
				{ value: 'Consolidating products', label: 'Consolidating products' },
				{ value: 'Forecasting', label: 'Forecasting' },
				{ value: 'Business planning', label: 'Business planning' },
				{ value: 'Making a Business Plan', label: 'Making a Business Plan' },
			],
			"FO-Technology and Product Development (Business Development)" : [
				{ value: 'Strategy formulation', label: 'Strategy formulation', },
				{ value: 'Product development', label: 'Product development', },
				{ value: 'Quality control measures', label: 'Quality control measures' },
			],
			"FO-Institutional Marketing Management" : [
				{ value: 'Market development', label: 'Market development', },
				{ value: 'Formulating value proposition', label: 'Formulating value proposition', },
				{ value: 'Identifying institutional buyers', label: 'Identifying institutional buyers' },
				{ value: 'Securing supply agreements', label: 'Securing supply agreements' },
				{ value: 'Digital marketing', label: 'Digital marketing' },
			],
			"FO-Human Resource Management" : [
				{ value: 'Staff hiring', label: 'Staff hiring', },
				{ value: 'Staff training', label: 'Staff training', },
				{ value: 'Providing technical assistance to members', label: 'Providing technical assistance to members' },
				{ value: 'Continuous education', label: 'Continuous education' },
				{ value: 'Selecting members', label: 'Selecting members' },
				{ value: 'Handling grievances', label: 'Handling grievances' },
			],
			"FO-Financial Management" : [
				{ value: 'Meeting working capital requirements', label: 'Meeting working capital requirements', },
				{ value: 'Knowledge of financial services', label: 'Knowledge of financial services', },
				{ value: 'Availing financial services', label: 'Availing financial services' },
				{ value: 'Recording financial transactions', label: 'Recording financial transactions' },
			],
			"FO-Networking and Linkage-Building (External Relation; Business Membership Organization)" : [
				{ value: 'Working with stakeholders', label: 'Working with stakeholders', },
				{ value: 'Coordinating with institutions for assistance', label: 'Coordinating with institutions for assistance', },
				{ value: 'Working with other organizations', label: 'Working with other organizations' },
				{ value: 'Complying with commitments', label: 'Complying with commitments' },
			],
			"MSME-Entrepreneurial Competency" : [
				{ value: 'Strategic planning', label: 'Strategic planning', },
				{ value: 'Commitment', label: 'Commitment', },
				{ value: 'Decision making', label: 'Decision making' },
				{ value: 'Identifying business opportunities', label: 'Identifying business opportunities' },
				{ value: 'Business networking', label: 'Business networking' },
				{ value: 'Innovation', label: 'Innovation' },
			],
			"MSME-Operations" : [
				{ value: 'Meeting quality specifications', label: 'Meeting quality specifications', },
				{ value: 'Meeting volume requirements', label: 'Meeting volume requirements', },
				{ value: 'Meeting delivery commitments', label: 'Meeting delivery commitments' },
				{ value: 'Forecasting', label: 'Forecasting' },
				{ value: 'Business planning', label: 'Business planning' },
				{ value: 'Making a Business Plan', label: 'Making a Business Plan' },
			],
			"MSME-Management" : [
				{ value: 'Identifying competitive advantage', label: 'Identifying competitive advantage', },
				{ value: 'Recording transactions', label: 'Recording transactions', },
				{ value: 'Complying with government regulations', label: 'Complying with government regulations' },
			],
			"MSME-Technology and Product Development" : [
				{ value: 'Strategy formulation', label: 'Strategy formulation', },
				{ value: 'Product development', label: 'Product development', },
				{ value: 'Transaction automation', label: 'Transaction automation' },
				{ value: 'Quality control measures', label: 'Quality control measures' },
			],
			"MSME-Marketing Management" : [
				{ value: 'Market development', label: 'Market development', },
				{ value: 'Formulating value proposition', label: 'Formulating value proposition', },
				{ value: 'Securing supply agreements', label: 'Securing supply agreements' },
				{ value: 'Digital marketing', label: 'Digital marketing' },
			],
			"MSME-Human Resource Management" : [
				{ value: 'Staff hiring', label: 'Staff hiring', },
				{ value: 'Staff training', label: 'Staff training', },
			],
			"MSME-Financial Management" : [
				{ value: 'Meeting working capital requirements', label: 'Meeting working capital requirements', },
				{ value: 'Knowledge of financial services', label: 'Knowledge of financial services', },
				{ value: 'Availing financial services', label: 'Availing financial services' },
				{ value: 'Recording financial transactions', label: 'Recording financial transactions' },
			],
			"MSME-Networking and Linkage-Building (External Relation; Business Membership Organization)" : [
				{ value: 'Working with stakeholders', label: 'Working with stakeholders', },
				{ value: 'Coordinating with institutions for assistance', label: 'Coordinating with institutions for assistance', },
				{ value: 'Working with other organizations', label: 'Working with other organizations' },
				{ value: 'Complying with commitments', label: 'Complying with commitments' },
			],
			"Individual Farmer-Managing Natural Resources" : [
				{ value: 'Production skills', label: 'Production skills', },
				{ value: 'Soil management', label: 'Soil management', },
				{ value: 'Water management', label: 'Water management' },
				{ value: 'Composting and use of fertilizers and chemicals', label: 'Composting and use of fertilizers and chemicals' },
				{ value: 'Mechanical skills', label: 'Mechanical skills' },
			],
			"Individual Farmer-Managing Finances" : [
				{ value: 'Keeping financial records', label: 'Keeping financial records', },
				{ value: 'Managing personal and business budgets', label: 'Managing personal and business budgets', },
				{ value: 'Effective use of debts and loans', label: 'Effective use of debts and loans' },
				{ value: 'Risk management skills', label: 'Risk management skills' },
			],
			"Individual Farmer-Marketing" : [
				{ value: 'Farming as a business', label: 'Farming as a business', },
				{ value: 'Business plan', label: 'Business plan', },
				{ value: 'Procurement and selling skills', label: 'Procurement and selling skills' },
				{ value: 'Collective marketing', label: 'Collective marketing' },
			],
			"Individual Farmer-Innovation" : [
				{ value: 'Product development', label: 'Product development', },
				{ value: 'Crop and product diversification', label: 'Crop and product diversification', },
				{ value: 'Technological advancements', label: 'Technological advancements' },
				{ value: 'Adaptability and problem-solving', label: 'Adaptability and problem-solving' },
				{ value: 'Data collection and analysis', label: 'Data collection and analysis' },
			],
			"Individual Farmer-Teamwork" : [
				{ value: 'Leadership skills', label: 'Leadership skills', },
				{ value: 'Personnel management skills', label: 'Personnel management skills', },
				{ value: 'Communication skills', label: 'Communication skills' },
				{ value: 'Effective team player', label: 'Effective team player' },
			],
		}
		CHOICES_SELECT['cbb_topic_of_training'].clearChoices()
		CHOICES_SELECT['cbb_topic_of_training'].setChoices(dyn_choices[val_],
			'value',
			'label',
			false,
		);

	$ID("cbb_topic_of_training").parentNode.querySelectorAll(".choices__input")[1].addEventListener("keyup",function(e){
		var cg_len = 0
		var req_cust_item = ["FO-GESI","FO-Social Environment & Climate","FO-Managing Natural Resources","MSME-GESI","MSME-Social Environment & Climate","MSME-Managing Natural Resources","Individual Farmer-GESI","Individual Farmer-Social Environment & Climate"]
		try {cg_len = dyn_choices[val_].length} 
		catch (error) {}
		println(req_cust_item.includes(val_))
		if(cg_len>=0){
			if(req_cust_item.includes(val_)){
				if(e.code == "Enter"){
					if(e.srcElement.value.length>=1){
						CHOICES_SELECT['cbb_topic_of_training'].setValue([e.srcElement.value]);
						e.srcElement.value = "";
					}
				}
			}
		}
	})
}

		   
	$(document).ready(function(){
		CHOICES_SELECT['cbb_topic_of_training'] = new Choices('#cbb_topic_of_training', {
			removeItemButton: true,
			searchChoices: true,
			// maxItemCount:4,
			// searchResultLimit:4,
			addItems: true,
			uniqueItemText: 'Only unique values can be added',
			customAddItemText: 'Only values matching specific conditions can be added',
			maxItemCount:21,
			searchResultLimit:21,
			addItems: true,
			searchEnabled: true,
			renderChoiceLimit:21,
			addItemText: (value) => {
				// println(CHOICES_SELECT['cbb_topic_of_training'])
				return `Press Enter to add <b>`+value+`</b>`;
			},
		}); 
	});


	$(document).ready(function(){
    $('#cbb_total_number_per_gender_male, #cbb_total_number_per_gender_female').on('input', function(){
      var male = parseFloat($('#cbb_total_number_per_gender_male').val()) || 0;
      var female = parseFloat($('#cbb_total_number_per_gender_female').val()) || 0;
      var total = male + female;
      $('#cbb_total_number_per_gender_total').val(total);
    });
  });  


  	$(document).ready(function(){
    $('#cbb_male_ip, #cbb_female_ip').on('input', function(){
      var male = parseFloat($('#cbb_male_ip').val()) || 0;
      var female = parseFloat($('#cbb_female_ip').val()) || 0;
      var total = male + female;
      $('#cbb_total_number_per_sector_ip').val(total);
    });
  });   


  	$(document).ready(function(){
    $('#cbb_female_youth, #cbb_male_youth').on('input', function(){
      var male = parseFloat($('#cbb_female_youth').val()) || 0;
      var female = parseFloat($('#cbb_male_youth').val()) || 0;
      var total = male + female;
      $('#cbb_total_number_per_sector_youth').val(total);
    });
  });   

  	$(document).ready(function(){
    $('#cbb_female_pwd, #cbb_male_pwd').on('input', function(){
      var male = parseFloat($('#cbb_female_pwd').val()) || 0;
      var female = parseFloat($('#cbb_male_pwd').val()) || 0;
      var total = male + female;
      $('#cbb_total_number_per_sector_pwd').val(total);
    });
  });   

  	$(document).ready(function(){
    $('#cbb_male_sc, #cbb_female_sc').on('input', function(){
      var male = parseFloat($('#cbb_male_sc').val()) || 0;
      var female = parseFloat($('#cbb_female_sc').val()) || 0;
      var total = male + female;
      $('#cbb_total_number_per_sector_sc').val(total);
    });
  });   

  var x_inputs_ = $CLASS('x-input')
	for (let index = 0; index < x_inputs_.length; index++) {
		if (x_inputs_[index].id != 'cbb_total_number_per_sector_total') {
			x_inputs_[index].addEventListener('keyup', function (ee) {
				var num1 = parseFloat($ID("cbb_total_number_per_sector_ip").value); 
				var num2 = parseFloat($ID("cbb_total_number_per_sector_pwd").value); 
				var num3 = parseFloat($ID("cbb_total_number_per_sector_youth").value); 
				var num4 = parseFloat($ID("cbb_total_number_per_sector_sc").value)
				if (isNaN(num1)) { num1 = 0 }
				if (isNaN(num2)) { num2 = 0 }
				if (isNaN(num3)) { num3 = 0 }
				if (isNaN(num4)) { num4 = 0 }
				$ID('cbb_total_number_per_sector_total').value = num1 + num2 + num3 + num4
			})
		}
	}
	</script>

{% endblock content %}
<!-- Specific JS goes HERE -->
{% block javascripts %}
{% endblock javascripts %}