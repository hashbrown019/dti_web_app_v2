<!DOCTYPE html>
<html>
{% include 'head.html' %}

	<body>
		<br id="top_br">
		<header class="x-header x-bar x-white x-top x-large " style="z-index:2;width: 100%;">
			<div class="x-container" style="margin-left:200px;margin-right:200px;border-bottom: 1px;border-top: 0px;border-left: 0px;border-right: 0px;border-style: solid;border-color: lightgrey;">
				<div class="x-container x-left"  onclick="x_open()" style="width:100px;">
					<img src="../static/img/mis_2023_v2.svg" class="x-circle x-margin-right" style="width:100%">
				</div>
				<div class="x-left x-text-teal" style="padding-top:20px">
					<b>MIS |</b><i> Data Capture Form Data Link</i>
				</div>
				<div class="x-right x-right-align x-container x-padding">
					<div class="x-container x-right-align" style="padding-top:6px">
						<span class="x-zoom x-text-grey x-padding x-margin-top x-round-xxlarge" onclick="alert('You cannot perform this action in this page. Save your progress and go back to the previous page')">
							<span class="x-large x-text-teal fa fa-home"></span>
							<span class="x-small"> Home</span>
						</span>
						<span class="x-zoom x-text-grey x-padding x-margin-top" onclick="alert('You cannot perform this action in this page. Save your progress and go back to the previous page')">
							<span class="x-large x-text-red fa fa-power-off"></span>
							<span class="x-small"> Logout</span>
						</span>
					</div>
				</div>
			</div>
			<div class="x-container x-text-grey" style="margin-left:200px;margin-right:200px;;margin-top:10px;">
				<div class="x-left">
					<span class="x-left-align" style="border-bottom: 1px;border-top: 0px;border-left: 0px;border-right: 0px;border-style: solid;border-color: lightgrey">
						<b id="l1"></b>
						<span class="x-text-shrink x-tiny" id="l2"></span>
					</span>
				</div>
				<div class="x-right">
					&nbsp;
					{% if(USER_DATA['profilepic']=="" or USER_DATA['profilepic']==" " ): %}
					<img src="\static\psalm_static\menu\img\profilepic.png" style="width: 40px; height: 40px;">
					{% else: %}
					<img class="rounded-circle x-circle" src="\api\user_pic\{{USER_DATA['profilepic']}}" alt="{{USER_DATA['profilepic']}}" style="width: 40px; height: 40px;">
					{%endif%}
				</div>
				<div class="x-right x-text-teal">
					<span class="x-right-align" style="border-bottom: 1px;border-top: 0px;border-left: 0px;border-right: 0px;border-style: solid;border-color: lightgrey">
						<b class="">{{USER_DATA['name']}}</b>
						<span class="x-text-shrink x-tiny">{{USER_DATA['job']}}</span>
					</span>
				</div>
			</div>
		</header>
		<!-- ================================================= -->
		<div class="x-main" style="margin-left:200px;margin-right:200px;margin-top:43px;">
			<div class="x-col l6 m6">
				<br><br><br>
				<div id="accordion_form" class="x-container">
					<h3>Input Form</h3>
					<div class="x-row x-container">
						<div class="x-row x-container x-padding">
							<b>Farmer's Name</b>
							<input id="link_from_id" class="f_profile" name="" hidden>
							<input id="link_to_id" class="f_profile main_input" name="" hidden>
							<div class="x-row password-container">
								<input id="fname" class="search_profile f_profile x-round-large main_input x-input x-border" type="text" placeholder="Input farmers name or search from inputed profiles to auto fill-up the fields"
									style="" required>
								<span class="x-right">
									<span class="password-toggle">
										Search 
										<i style="color: #262626; font-weight: 800;" class="fa fa-search x-hover-text-blue" onclick="search_profile()"></i>
									</span>
								</span>
							</div>
						</div>
						<div class="x-row">
							<div class="x-col l6 m6 x-container x-padding">
								<b>Address</b>
								<div class="x-row">
									<div class="x-col l3">
										<span>Region</span>
										<input id="addr_region" class="f_profile x-round-large main_input x-input x-border" type="" name="">
									</div>
									<div class="x-col l3">
										<span>Province</span>
										<input id="addr_prov" class="f_profile x-round-large main_input x-input x-border" type="" name="">
									</div>
									<div class="x-col l3">
										<span>City</span>
										<input id="addr_city" class="f_profile x-round-large main_input x-input x-border" type="" name="">
									</div>
									<div class="x-col l3">
										<span>Brgy</span>
										<input id="addr_brgy" class="f_profile x-round-large main_input x-input x-border" type="" name="">
									</div>
								</div>
								<b>Primary Crop/Commodity</b>
								<input id="farmer_primary_crop" class="f_profile x-round-large main_input x-input x-border" type="" name="">
							</div>
							<div class="x-col l6 m6 x-container x-padding">
								<b>Sex</b>
								<select id="sex" class="f_profile x-round-large main_input x-input x-select x-border">
									<option value="Male">Male</option>
									<option value="Female">Female</option>
								</select>
								<b>Birthday</b>
								<input id="farmer_bday" class="f_profile x-round-large main_input x-input x-border" type="date" name="">
								<b>Civil Status</b>
								<input id="civil_status" class="f_profile x-round-large main_input x-input x-border" type="text" name="">
								<select id="type" class="f_profile x-round-large x-input x-border">
									
								</select>
								<div class="x-container">
									<input id="id" class="f_profile x-round-large x-tiny x-white x-text-grey x-col l6 m6 s6" type="" name="" style="border:0px;width:50%;text-align:right;font-weight:bold" disabled>
									<input id="reference" class="f_profile x-round-large x-tiny x-white x-text-grey x-col l6 m6 s6" type="" name="" style="border:0px;width:50%" disabled>
								</div>
							</div>
						</div>
					</div>
					<div class="x-row x-container">
						<div class="x-container x-right">
							<button class="x-btn x-round-large x-green" onclick="add_profile()">Add Profile to the list</button>
							<button class="x-btn x-round-large x-red" onclick="clear_form_field()">Clear Input Fields</button>
						</div>
					</div> 
				</div>
			</div>

			<div class="x-col l6 m6">
				<div class="x-container x-row">
					<br><br><br>
					<h3>Entry List</h3>
				</div>

				<div class="x-container x-row">

					<div class="x-container">
						<div class="x-container x-card x-round x-white">
							<div class="x-col l6 m6">
								<b>Juan Dela Cruz</b> | Male | Single | Oct 19 1994
								<br>
								<b>Cacao</b> | tungao, Butuan, Agusan del Norte, 13
							</div>
							<div class="x-col l6 m6 x-text-red">
								<div class="x-padding x-right">
									<span class="fa fa-trash x-text-red"></span> Remove
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>


		<div id="ls_modal" style="display: none;">
			<div id="ls_farmer" class="x-container" style="overflow-y:scroll;height: 60vh;">
				Loading
			</div>
		</div>
		<script type="text/javascript">
			var farmer_ls_modal

			function clear_form_field(){
				var main_input = $CLASS('main_input')
				for (var i = 0; i < main_input.length; i++) {
					main_input[i].disabled = false
					main_input[i].value = ""
				}
				var f_profile = $CLASS('f_profile')
				for (var i = 0; i < f_profile.length; i++) {
					f_profile[i].value = ""
				}
			}


			function search_profile(){
				var search_key = $ID('fname').value
				alert('Click to continue searching ['+search_key+']')
				SPINNER_LOADER.show()
				$send({
					action : "/formb/search_farmer_profile",
					method : POST,
					err_dialog:true,
					data : $DATA({'search_item':search_key}),
					func : function (rest){
						var res_ = JSON.parse(rest)
						var out_dup = ""
						for (var x = 0; x < res_.length; x++) {
							var str_res = JSON.stringify(res_[x]).replaceAll('"',"^")
							out_dup +=(`
								<div class="x-row x-padding x-leftbar x-hover-border-green x-hover-pale-green">
									<div class='x-col m10 l10'>
										<b>`+res_[x]['fname']+`</b> |
										<span><span class='x-text-grey'>Address :</span> 
										R`+res_[x]['addr_region']+`:, `+res_[x]['addr_prov']+`, `+res_[x]['addr_city']+`, `+res_[x]['addr_brgy']+` 
										</span> |
										<span><span class='x-text-grey'>Crop/Commodity :</span> 
										`+res_[x]['farmer_primary_crop']+`</span><br>
										&nbsp;
										<span><span class='x-text-grey'>reference :</span> 
										<i class='x-tiny'>`+res_[x]['reference']+`</i></span>
									</div>
									<div class='x-col m2 l2'>
										<button class='x-right x-btn x-green x-hover-black x-round-large' onclick='fill_selected_profile("`+str_res+`")'>
											<span class='fa fa-plus'></span>
										</button>
									</div>
								</div>
							`)
						}
						$ID('ls_farmer').innerHTML = out_dup
						farmer_ls_modal = $dialog({
							title : "Search Results",
							subtitle : "Below are the list of search records result you may click one and the system will auto feel the fields (not editable)",
							content : $ID('ls_modal').innerHTML
						})
						farmer_ls_modal.show()  
						SPINNER_LOADER.hide()
					},
					err : function(res){println(res)},
					progress : function(e){ 
						// var response_length = parseFloat(headerMap(e)['total'])
						var response_length = parseFloat(e.total)
						var response_loaded = parseFloat(e.loaded)
						var percent_  = (response_loaded / response_length) * 100;
						var percent_rounded = Math.round(percent_ * 100) / 100
						SPINNER_LOADER.loading(Math.round(percent_))
						SPINNER_LOADER.message(`
							<span>
								Gathering 
								<b>`+Math.round(percent_)+`%</b><br>
								<span class="x-small">
									[ `+(response_loaded/1000000).toFixed(1)+" / "+(response_length/1000000).toFixed(1)+` Mb ]<br>
									<i>`+(response_length-response_loaded)+` bytes remaining</i>
								</span>
							</span>
						`);
					}
				})
				// TABLE.ajax.url('/feature_0/filter_list_farmers')
				// TABLE.ajax.reload()
			}

			function fill_selected_profile(profile_){
				profile_ = JSON.parse(profile_.replaceAll("^",'"'))
				profile_['link_to_id'] = profile_['id']
				profile_["not_recorded"] = {}
				profile_['link_from_id'] = URL_ARGS["h"]
				json_to_input("f_profile",profile_)
				farmer_ls_modal.destroy()

				var main_input = $CLASS('main_input')
				for (var i = 0; i < main_input.length; i++) {
					main_input[i].disabled = true
				}
				println(profile_)
			}

			function add_profile(){
				var profile_added=input_to_json('f_profile')
				if(profile_added["link_to_id"]=='' || profile_added["link_to_id"]==' ' || profile_added["link_to_id"]== undefined){
					profile_added["not_recorded"] = input_to_json('f_profile')
				}
				profile_added['link_from_id'] = URL_ARGS["h"]
				println(profile_added)
			}


			function myFunction(id) {
				var x = document.getElementById(id);
				if (x.className.indexOf("x-show") == -1) {
					x.className += " x-show";
				} else { 
					x.className = x.className.replace(" x-show", "");
				}
			}

			$onload(function(){
				$ID('l1').innerHTML = FORM_NAME[URL_ARGS["i"]]
				$ID('link_from_id').value = URL_ARGS["h"]

				$ID('l2').innerHTML = "Farmer's Profile/ Participants/ Beneficiaries"
			})
			var FORM_NAME={
				'dcf_prep_review_aprv_status' : 'FORM 1 - PREPARATION, REVIEW AND APPROVAL STATUS',
				'dcf_implementing_unit' : 'FORM 2 - CPA TRACKER',
				'dcf_bdsp_reg' : 'FORM 3 - BDSP REGISTRY',
				'dcf_capacity_building' : 'FORM 4 - CAPACITY BUILDING FOR BENEFICIARIES',
				'dcf_matching_grant' : 'FORM 5 - MATCHING GRANT IMPLEMENTATION TRACKER',
				'dcf_product_development' : 'FORM 6 - PRODUCT DEVELOPMENT/ ENHANCEMENT ASSISTANCE PROVIDED/ CONSULTANCY SERVICES',
				'dcf_trade_promotion' : 'FORM 7 - TRADE PROMOTION SERVICES TRACKER',
				// 'form8' : 'form8_',
				'dcf_enablers_activity' : "FORM 9 - ENABLERS ACTIVITY TRACKER",
				'dcf_negosyo_center' : 'FORM 10 - NEGOSYO CENTER TRACKER',
				'dcf_access_financing' : 'FORM 11 - ACCESS TO FINANCING TRACKER',
			}
		</script>
	</body>

</html>
