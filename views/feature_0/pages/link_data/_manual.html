<div id="accordion_form" class="">
	<span class="x-container x-text-red">
		<b>Not Recommended</b><br>
		<i>This feature soon to be remove, we recommend the users to use Bulk Upload instead</i>
	</span>
	<h3>Input Form</h3>
	<div class="x-row">
		<div class="x-row x-container">
			<b>Type of Beneficiary/participants</b>
			<select id="type" class="f_profile main_input x-input x-border" onchange="">
				<option value="none">None/Guest</option>
				<option value="farmer">Farmer</option>
				<option value="fo">Farmer's Organization</option>
				<option value="msme">MSME</option>
			</select>
		</div>					
		<div id="f_filed" class="x-row" class="">						
			<div class="x-row x-container x-padding">
				<b>Name of Benificiary/Participants</b>
				<input id="link_from_id" class="f_profile f_clear" name="" hidden>
				<input id="link_to_id" class="f_profile f_clear main_input" name="" hidden>
				<div class="x-row password-container">
					<input id="fname" class="search_profile f_profile f_clear main_input x-input x-border" type="text" placeholder="Input farmers name or search from inputed profiles to auto fill-up the fields"
						style="" required>
					<span class="x-right">
						<span class="password-toggle x-hover-text-blue" onclick="search_profile()">
							Search 
							<i style="font-weight: 800;" class="fa fa-search"></i>
						</span>
					</span>
				</div>
			</div>
			<div class="x-row">
				<div class="x-col l6 m6 x-container x-padding">
					<div class="x-row">
						<b>Address</b>
						<div class="x-row">
								<span>Region</span>
								<input id="addr_region" class="f_profile f_clear main_input x-input x-border" type="" name="">
					
								<span>Province</span>
								<input id="addr_prov" class="f_profile f_clear main_input x-input x-border" type="" name="">
					
								<span>City</span>
								<input id="addr_city" class="f_profile f_clear main_input x-input x-border" type="" name="">
					
								<span>Brgy</span>
								<input id="addr_brgy" class="f_profile f_clear main_input x-input x-border" type="" name="">
					
						</div>
						<b>Primary Crop/Commodity</b>
						<input id="farmer_primary_crop" class="f_profile f_clear main_input x-input x-border" type="" name="">
					</div>
					<!-- ========================================== -->
					<!-- ========================================== -->
					<!-- ========================================== -->
					<!-- ========================================== -->
					<div id="for_dcf_trade_promotion" style="display:none">
						<hr>
						<b class="x-large">For Trade Fairs</b><br>
						<b>Name Of Prodduct</b>
						<input id="trade_fair_prod_name" class="trade_fair f_clear  x-input x-border" type="" name="">
						<b>Buyer</b>
						<input id="trade_fair_buyer" class="trade_fair f_clear x-input x-border" type="" name="">
						<b>Cash Sales</b>
						<input id="trade_fair_cash_sales" class="trade_fair f_clear x-input x-border" type="" name="">
						<b>Book Sales</b>
						<input id="trade_fair_book_sales" class="trade_fair f_clear x-input x-border" type="" name="">
						<b>Under Nego</b>
						<input id="trade_fair_under_nego" class="trade_fair f_clear x-input x-border" type="" name="">
						<b>Sales</b>
						<input id="trade_fair_sales" class="trade_fair f_clear x-input x-border" type="" name="">
					</div>
					<!-- ========================================== -->
					<!-- ========================================== -->
					<!-- ========================================== -->
					<!-- ========================================== -->

				</div>
				<div class="x-col l6 m6 x-container x-padding x-pale-green">
					<b class="x-small">Only fill up this form if the type of participants/benificiary is not a group (MSME,FO) otherwise, leave this field blank</b>
					<div class="x-padding x-container">
						<b>Sex</b>
						<select id="sex" class="f_profile f_clear main_input x-input x-select x-border">
							<option value="">none</option>
							<option value="Male">Male</option>
							<option value="Female">Female</option>
						</select>
						<b>Birthday</b>
						<input id="farmer_bday" class="f_profile f_clear main_input x-input x-border" type="date" name="">
						<b>Civil Status</b>
						<input id="civil_status" class="f_profile f_clear main_input x-input x-border" type="text" name="">

						<label class=""><span style="color: #007399;" class="tool" data-tip="You can select multiple options from the provided list; text input won't be recorded." tabindex="1"><i class="fa-solid fa-circle-info"></i></span> MSMEs:</label>
						<select class="f_profile f_clear x-btn x-block" id="sectoral" name="sectoral[]" multiple>
							<option value="Abled" selected>Abled</option>
							<option value="PWD">PWD</option>
							<option value="Youth">Youth</option>
							<option value="Senior Citizen">Senior Citizen</option>
							<option value="OFW">OFW</option>
						</select>

						<div class="x-container">
							<input id="id" class="f_profile f_clear x-tiny x-pale-green x-text-grey x-col l6 m6 s6" type="" name="" style="border:0px;width:50%;text-align:right;font-weight:bold" disabled>
							<input id="reference" class="f_profile f_clear x-tiny x-pale-green x-text-grey x-col l6 m6 s6" type="" name="" style="border:0px;width:50%" disabled>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
	<br>
	<div class="x-row x-container">
		<div class="x-container x-right">
			<button class="x-btn x-green" onclick="add_profile()">Add Profile to the list</button>
			<button class="x-btn x-red" onclick="clear_form_field()">Clear Input Fields</button>
		</div>
	</div> 
</div>

<script type="text/javascript">
	

	$onload(function(){
		$(document).ready(function(){
			var sectoral= new Choices('#sectoral', {
				removeItemButton: true,
				choices: ["Large","Medium","Small","Micro"],
				// items: ["Large","Medium","Small","Micro"],
				searchChoices: true,
				// maxItemCount:4,
				// searchResultLimit:4,
				addItems: true,
				uniqueItemText: 'Only unique values can be added',
				customAddItemText: 'Only values matching specific conditions can be added',
				addItemText: (value) => {
					// println(multipleCancelButton)
					return `Press Enter to add <b>`+value+`</b>`;
				},
			}); 
		});
	})

	function clear_form_field(){
		var main_input = $CLASS('main_input')
		for (var i = 0; i < main_input.length; i++) {
			main_input[i].disabled = false
			main_input[i].value = ""
		}
		var f_profile = $CLASS('f_profile')
		for (var i = 0; i < f_profile.length; i++) {
			f_profile[i].value = ""
		}
	}

	function download_login_start(fff){
		let a= document.createElement('a');
		a.target= '_blank';
		a.href= '/login/download_file/'+fff;
		a.click();
	}


	function search_profile(){
		var type_ = $ID('type').value
		var API_ = ""
		if(type_== 'farmer'){API_ = "search_farmer_profile"}
		else if(type_== 'fo'){API_ = "search_farmer_org"}
		else {return}
			
		var search_key = $ID('fname').value
		SPINNER_LOADER.show()
		$send({
			action : "/data_link/"+API_,
			method : POST,
			err_dialog:true,
			data : $DATA({'search_item':search_key}),
			func : function (rest){
				var res_ = JSON.parse(rest)
				var out_dup = ""
				for (var x = 0; x < res_.length; x++) {
					var str_res = JSON.stringify(res_[x]).replaceAll('"',"^")
					out_dup +=(`
						<div class="x-row x-padding x-leftbar x-hover-border-green x-hover-pale-green">
							<div class='x-col m10 l10'>
								<b>`+res_[x]['fname']+`</b> |
								<span><span class='x-text-grey'>Address :</span> 
								R`+res_[x]['addr_region']+`:, `+res_[x]['addr_prov']+`, `+res_[x]['addr_city']+`, `+res_[x]['addr_brgy']+` 
								</span> |
								<span><span class='x-text-grey'>Crop/Commodity :</span> 
								`+res_[x]['farmer_primary_crop']+`</span><br>
								&nbsp;
								<span><span class='x-text-grey'>reference :</span> 
								<i class='x-tiny'>`+res_[x]['reference']+`</i></span> ||
								<span><span class='x-text-grey'>Search Accuracy :</span> 
								<i class='x-tiny'>`+res_[x]['search_acc']+`</i></span> 
							</div>
							<div class='x-col m2 l2'>
								<button class='x-right x-btn x-green x-hover-black' onclick='fill_selected_profile("`+str_res+`")'>
									<span class='fa fa-plus'></span>
								</button>
							</div>
						</div>
					`)
				}
				$ID('ls_farmer').innerHTML = out_dup
				farmer_ls_modal = $dialog({
					title : "Search Results",
					subtitle : "Below are the list of search records result you may click one and the system will auto feel the fields (not editable)",
					content : $ID('ls_modal').innerHTML
				})
				farmer_ls_modal.show()  
				SPINNER_LOADER.hide()
			},
			err : function(res){println(res)},
			progress : function(e){ 
				// var response_length = parseFloat(headerMap(e)['total'])
				var response_length = parseFloat(e.total)
				var response_loaded = parseFloat(e.loaded)
				var percent_  = (response_loaded / response_length) * 100;
				var percent_rounded = Math.round(percent_ * 100) / 100
				SPINNER_LOADER.loading(Math.round(percent_))
				SPINNER_LOADER.message(`
					<span>
						Gathering 
						<b>`+Math.round(percent_)+`%</b><br>
						<span class="x-small">
							[ `+(response_loaded/1000000).toFixed(1)+" / "+(response_length/1000000).toFixed(1)+` Mb ]<br>
							<i>`+(response_length-response_loaded)+` bytes remaining</i>
						</span>
					</span>
				`);
			}
		})
		// TABLE.ajax.url('/feature_0/filter_list_farmers')
		// TABLE.ajax.reload() f_clear
	}

	function fill_selected_profile(profile_){
		var _type = $ID('type').value
		profile_ = JSON.parse(profile_.replaceAll("^",'"'))
		profile_['link_to_id'] = profile_['id']
		// profile_['link_to_id'] = profile_['id']
		profile_["not_recorded"] = {}
		profile_['link_from_id'] = URL_ARGS["h"]
		json_to_input("f_profile",profile_)
		farmer_ls_modal.destroy()

		var main_input = $CLASS('main_input')
		for (var i = 0; i < main_input.length; i++) {
			main_input[i].disabled = true
		}
		profile_["type"] = _type
		$ID('type').value = _type
		println(profile_)
	}


	function multiple_ch(TAG){
		var selected_arr =[]; selected = TAG.querySelectorAll("option")
		for(var i = 0; i < selected.length; i++) {selected_arr.push(selected[i].innerText)}
		return selected_arr.join(",")
	}


	function add_profile(){
		var sectoral = multiple_ch($ID("sectoral"))
		var profile_added=input_to_json('f_profile')
		var trade_fair = JSON.stringify(input_to_json('trade_fair'))
		if(profile_added["link_to_id"]=='' || profile_added["link_to_id"]==' ' || profile_added["link_to_id"]== undefined){
			profile_added["not_recorded"] = JSON.stringify(input_to_json('f_profile'))
		}
		profile_added['link_from_id'] = URL_ARGS["h"]
		profile_added['type'] = $ID('type').value
		profile_added['db_table'] = URL_ARGS["i"]
		profile_added['sectoral'] = sectoral
		profile_added['data'] = trade_fair
		delete profile_added['id']
		println(profile_added)
		add_entry_benef(profile_added)
	}


	function myFunction(id) {
		var x = document.getElementById(id);
		if (x.className.indexOf("x-show") == -1){x.className += " x-show";} 
		else {x.className = x.className.replace(" x-show", "");}
	}

	function add_entry_benef(form_){
		$send({
			action : "/feature_0/link_data_dcf_form_a_add",
			method : POST,
			data : $DATA(form_),
			func : function(res){
				get_list_benef()
			}
		})
	}

	
</script>