
<div class="x-row x-container">
	<h2 class="x-text-teal"><b>Farmers' Organization Entry Lists</b></h2>

	<div class="x-text-grey">
		Some entries will not appear nor include to the counting if the entry in a specific consolidation of field data is incorrect, blank or not listed on the baseline lists of dashboards data. Please check entries before submitting or perform regular data cleaning of the records
	</div>
</div>

<div class="x-row x-container">
	<div class="x-col x-card x-zoom x-bottombar gr_body x-round-large x-white x-padding x-margin" style="width:15%">
		<div class="card-inner">
			<b class=" x-xxlarge x-text-white" id="num_input_fo">{{ num_fo_sex['total_form_b'] }}</b>
			<!-- <span style="color: #009973;" class="fa fa-users"></span> -->
			<span class="fa fa-users x-text-light-grey"></span>
		</div>
		<div class="card-progress">
			<small class="x-text-light-grey">NO. OF INPUTED FARMERS ORGANIZATION</small>
		</div>
		<span class=""></span>
	</div>
	<!-- =============== -->
	<div class="x-col x-zoom x-bottombar x-container x-card x-round-large x-white x-padding x-margin x-border x-border-teal" style="width:20%;">
		<div class="" style="line-height: 10%;">
			<div class="x-half" >
				<span class="" style="color: #0099cc">
					Male&nbsp;<i style="height: 40px;width: 40px; color: #0099cc;" class="fa fa-solid fa-user"></i>
				</span><br>
				<b class="x-xxlarge" id="num_input_fo_male" style="color: #0099cc;">{{num_fo_sex['male']}}</b>
			</div>
			<div class="x-half" >
				<span class="" style="color: #FF5733;">
					Female&nbsp;<i style="height: 40px;width: 40px; color: #FF5733;" class="fa fa-solid fa-user"></i>
				</span><br>
				<b class="x-xxlarge" style="color: #FF5733;" id="num_input_fo_female">{{num_fo_sex['female']}}</b>
				
			</div>
		</div>
		<br>
		<br>
		<br>
		<div class="card-progress" style="line-height: 90%;">
			<small class="x-text-grey">
				<b>Respondent's Position in F.O</b><br>
				<span class="x-tiny">Chairperson, Chairwoman, Coop Chairperson, General Manager, Manager, President/Chairman</span>
			</small>
		</div>
		<span class=""></span>
	</div>
	<!-- =============== -->
	<div class="x-col x-zoom x-bottombar x-container x-card x-round-large x-white x-padding x-margin x-border x-border-orange" style="width:20%;">
		<div class="" style="line-height: 10%;">
			<div class="x-half" >
				<span class="" style="color: #0099cc">
					Male&nbsp;<i style="height: 40px;width: 40px; color: #0099cc;" class="fa fa-solid fa-user"></i>
				</span><br>
				<b class="x-xxlarge" id="num_input_fo_male" style="color: #0099cc;">{{num_fo_sex['total_male_board']}}</b>
			</div>
			<div class="x-half" >
				<span class="" style="color: #FF5733;">
					Female&nbsp;<i style="height: 40px;width: 40px; color: #FF5733;" class="fa fa-solid fa-user"></i>
				</span><br>
				<b class="x-xxlarge" style="color: #FF5733;" id="num_input_fo_female">{{num_fo_sex['total_female_board']}}</b>
				
			</div>
		</div>
		<br>
		<br>
		<br>
		<div class="card-progress" style="line-height: 90%;">
			<small class="x-text-grey">
				<b>F.O's Decision Making Body group by Sex (BOARD)</b><br>
				<span class="x-tiny">Chairperson, Chairwoman, Coop Chairperson, General Manager, Manager, President/Chairman</span>
			</small>
		</div>
		<span class=""></span>
	</div>
	<!-- =============== -->
	<div class="x-col x-zoom x-bottombar x-container x-card x-round-large x-white x-padding x-margin x-border x-border-green" style="width:20%;">
		<div class="" style="line-height: 10%;">
			<div class="x-half" >
				<span class="" style="color: #0099cc">
					Male&nbsp;<i style="height: 40px;width: 40px; color: #0099cc;" class="fa fa-solid fa-user"></i>
				</span><br>
				<b class="x-xxlarge" id="num_input_fo_male" style="color: #0099cc;">{{num_fo_sex['mngmt_male']}}</b>
			</div>
			<div class="x-half" >
				<span class="" style="color: #FF5733;">
					Female&nbsp;<i style="height: 40px;width: 40px; color: #FF5733;" class="fa fa-solid fa-user"></i>
				</span><br>
				<b class="x-xxlarge" style="color: #FF5733;" id="num_input_fo_female">{{num_fo_sex['mngmt_female']}}</b>
				
			</div>
		</div>
		<br>
		<br>
		<br>
		<div class="card-progress" style="line-height: 90%;">
			<small class="x-text-grey">
				<b>F.O's Decision Making Body group by Sex (Management Committee)</b><br>
				<span class="x-tiny">Chairperson, Chairwoman, Coop Chairperson, General Manager, Manager, President/Chairman</span>
			</small>
		</div>
		<span class=""></span>
	</div>
</div>

<div class="x-row x-container">
	<table class="display" id="table_id_fo" style="width:100%">
		<thead class="x-rapid-teal-heavy" style="width:100%">
			<tr class="">
				<th hidden>
					ID<br>
					<input style="border:0px" type="text" placeholder="Search" data-index="0" />
				</th>
				<th>
					Farmer's Org Name<br>
					<input style="border:0px" type="text" placeholder="Search" data-index="1" />
				</th>
				<th>
					Address<br>
					<input style="border:0px" type="text" placeholder="Search" data-index="2" />
				</th>
				<th>
					Type of Organization<br>
					<input style="border:0px" type="text" placeholder="Search" data-index=3 />
				</th>
				<th>
					Registering Agencies<br>
					<input style="border:0px" type="text" placeholder="Search" data-index="4" />
				</th>
				<th>
					Inputed By<br>
					<input style="border:0px" type="text" placeholder="Search" data-index="1" />
				</th>
				<th>
					RCU<br>
					<input style="border:0px" type="text" placeholder="Search" data-index="1" />
				</th>
			</tr>
		</thead>
		<tbody id="list_farmers">
		</tbody>
	</table>
</div>

<script type="text/javascript">
	var init_counter = 0
	let TABLE

	function showing_table_ls_farmer(){
		SPINNER_LOADER.show()
		$send({
			action : "/formb/get_list_fo",
			method : POST,
			// a_sync : false,
			func : function (rest){
				println(" -- Getting List Farmers Done")
				var raw_data = JSON.parse(rest)
				$ID('num_input_fo').innerHTML = raw_data.length

				var res = popu__int_toData(raw_data)

				try{
					create_table(res)
				}catch(e){
					println(e)
					alert("An Error/Warning occurred during Data Loading\n\nErro/Warningr message\n[ "+e+" ]\n\n You may continue your transaction by clicking the button below")
				}
				SPINNER_LOADER.hide()

			},
			err : function(res){println(res);SPINNER_LOADER.hide()},
			progress : function(e){
				// var response_length = parseFloat(headerMap(e)['total'])
				var response_length = parseFloat(e.total)
				var response_loaded = parseFloat(e.loaded)
				var percent_  = (response_loaded / response_length) * 100;
				var percent_rounded = Math.round(percent_ * 100) / 100
				SPINNER_LOADER.loading(Math.round(percent_))
				SPINNER_LOADER.message(`
					<span>
						Gathering 
						<b>`+Math.round(percent_)+`%</b><br>
						<span class="x-small">
							[ `+(response_loaded/1000000).toFixed(1)+" / "+(response_length/1000000).toFixed(1)+` Mb ]<br>
							<i>`+(response_length-response_loaded)+` bytes remaining</i>
						</span>
					</span>
				`);
			}
		})
		// TABLE.ajax.url('/feature_0/filter_list_farmers')

		// TABLE.ajax.reload()
	}


	function create_table(data_) {
	println(" -- Creating Data Table")
	TABLE = new DataTable('#table_id_fo', {
		"scrollY": '60vh',
		"scrollX": true,
		"data": data_,
		"pageLength": 25,
		"columnDefs": [
		{
			"targets": -1,
			"className": 'compact'
		},
		{
			"target": 0,
			"visible": false,
			"searchable": false,
		},
		],
		"order": [[ 0, "desc" ]], // Add this line to sort by date in descending order
		"initComplete": function () {
		// Add Export button right after the search bar
		const exportBtn = `
			<span class="x-zoom x-text-grey x-round-xxlarge x-hover-shadow" 
			onclick="goto('/formb/get_list_fo_full')" 
			style="cursor: pointer; padding: 8px 12px; margin-left: 10px;">
			<span class="x-text-orange fa fa-download"></span>
			<span class="x-small">Export Data</span>
			</span>
		`;
		$('.dataTables_filter').append(exportBtn);
		}
	});

	set_search_field();
	}

	function set_search_field(){
		$(TABLE.table().container() ).on('keyup', 'thead input', function () {
			TABLE
				.column( $(this).data('index') )
				.search( this.value )
				.draw();
		} );
		$('#table_id_fo tbody').on('mousedown', 'tr', function () {
			var data = TABLE.row(this).data();
			// show_fo_ind_(data[0]); //got to form details
			show_dialog_item(data[0],data[1])
		})
	}

	function show_dialog_item(ids, nameorg) {
		Swal.fire({
			title: nameorg,
			text: `Control the data for the entry [${nameorg}]`,
			icon: 'info',
			showCancelButton: true,
			showDenyButton: true,
			confirmButtonText: 'View',
			denyButtonText: 'Delete',
			cancelButtonText: 'Cancel',
			confirmButtonColor: '#3085d6',
			denyButtonColor: '#d33',
		}).then((result) => {
			if (result.isConfirmed) {
				show_fo_ind_(ids);
			} else if (result.isDenied) {
				Swal.fire({
					title: 'Confirm Delete Record',
					text: 'You are about to delete an entry. Choose carefully.',
					icon: 'warning',
					showCancelButton: true,
					confirmButtonText: 'Delete',
					cancelButtonText: 'Go Back',
					confirmButtonColor: '#d33',
					cancelButtonColor: '#3085d6',
				}).then((res) => {
					if (res.isConfirmed) {
						$send({
							action: "/formb/delete_item",
							method: POST,
							data: $DATA({ "id": ids }),
							func: function (r) {
								var parsed = JSON.parse(r);
								window.location.reload();
							}
						});
					}
				});
			}
		});
	}

	function popu__int_toData(res){
		for (var i = 0; i < res.length; i++) {
			if(parseInt(res[i][3]) != NaN ){
				res[i][3] = TYPES_ORG[parseInt(res[i][3])]
			}
			if(parseInt(res[i][4]) != NaN ){
				res[i][4] = REG_AGENCIES[parseInt(res[i][4])]
			}
		}
		return res
	}

	function clear_form_field(){
		var form_data_b = $CLASS("form_data_b")
		for (var i = 0; i < form_data_b.length; i++) {
			var input_type = form_data_b[i].type
			if(form_data_b[i].id==""){continue}
			if( (["text","textarea","select-one","date","time"]).includes(input_type) ){
				form_data_b[i].value = ""
			}
			else if( (["radio"]).includes(input_type) ){
				form_data_b[i].checked = ""
			}
			form_data_b[i].disabled = false
		}

	}

	function show_fo_ind_(ids){
		$send({
			action : "/formb/get_ind_fo",
			method : POST,
			data : $DATA({"id":ids}),
			func : function(rrr){
				var resp = JSON.parse(rrr)
				println(resp)

				var FORM_DATA = {}
				var form_data_b = $CLASS("form_data_b")
				for (var i = 0; i < form_data_b.length; i++) {
					var input_type = form_data_b[i].type
					if(form_data_b[i].id==""){continue}
					if( (["text","textarea","select-one","date","time"]).includes(input_type) ){
						form_data_b[i].value = resp[0][form_data_b[i].id]
					}
					else if( (["radio"]).includes(input_type) ){
						form_data_b[i].checked = resp[0][form_data_b[i].id]
					}
					else if( (["checkbox"]).includes(input_type) ){
						if(resp[0][form_data_b[i].id]==true || resp[0][form_data_b[i].id]=='true'){
							form_data_b[i].click()
						}
					}
					// if(parseInt(form_data_b[i].uploaded_by)==parseInt("{{USER_DATA['name']}}")){
					// 	println('OWNED')
					// 	form_data_b[i].disabled = true
					// }
				}
				show_view('forms','page_content')
			}
		})
		// showing_table_ls_farmer()
	}

</script>