<style type="text/css">

	.password-container {
		position: relative;
	}

	.password-toggle {
		position: absolute;
		top: 50%;
		right: 10px;
		transform: translateY(-50%);
		cursor: pointer;
	}
</style>

<input class="form_data_b" id="id" name="first" type="text" hidden required>

<div id="form_header" class="main-title">
	<div class="x-left">
		<p class="font-weight-bold " >FORM B</p>
	</div>
	<div class="x-right">
		<p class="font-weight-bold x-btn x-text-blue x-round-large" onclick="show_mem_modal()">Add Farmer Members</p>
		<p class="font-weight-bold x-btn x-green" onclick="save_form()" >Save</p>
	</div>
</div>

<div id="respondents" class="form_container x-container" style="display:block;">
	{% include "B1-Respondents.html" %}
</div>
<div id="organizational" class="form_container x-container" style="display:block;">
	{% include "B2-Organizational.html" %}
</div>
<div id="operational" class="form_container x-container" style="display:block;">
	{% include "B3-Operational.html" %}
</div>
<div id="fogcp" class="form_container x-container" style="display:block;">
	{% include "B4-FoGovernance.html" %}
</div>
<div id="admin" class="form_container x-container" style="display:block;">
	{% include "B5-Administrative.html" %}
</div>
<div id="capacity" class="form_container x-container" style="display:block;">
	{% include "B6-Capacity.html" %}
</div>
<div id="partnership" class="form_container x-container" style="display:block;">
	{% include "B7-Partnership.html" %}
</div>

<div id="form_header" class="main-title">
	<p class="font-weight-bold x-left" >FORM B</p>
	<p class="font-weight-bold x-btn x-right x-green" onclick="save_form()" >Save</p>
</div>

<div id="mem_modal_conts" style="display: block;">
	<div class="x-container x-row">
		<div class="x-col l6 m6 x-container x-padding">
			<div class="x-row">
				<b>Farmer's Name</b>
				<div class="x-row password-container">
					<input id="search_key" class="search_profile x-input x-border" type="text" placeholder="Farmers Name"
						style="" required>
					<span class="password-toggle"><i style="color: #262626; font-weight: 800;" class="fa fa-search x-hover-text-blue" onclick="search_profile()"></i></span>
				</div>
			</div>
			<b>Address</b>
			<div class="x-row">
				<div class="x-col l3">
					<span>Region</span>
					<input class="x-input x-border" type="" name="">
				</div>
				<div class="x-col l3">
					<span>Province</span>
					<input class="x-input x-border" type="" name="">
				</div>
				<div class="x-col l3">
					<span>City</span>
					<input class="x-input x-border" type="" name="">
				</div>
				<div class="x-col l3">
					<span>Brgy</span>
					<input class="x-input x-border" type="" name="">
				</div>
			</div>
			<b>Primary Crop/Commodity</b>
			<input class="x-input x-border" type="" name="">
		</div>
		<div class="x-col l6 m6 x-container x-padding">
			<b>Sex</b>
			<select class="x-input x-select x-border">
				<option value="Male">Male</option>
				<option value="Female">Female</option>
			</select>
			<b>Birthday</b>
			<input class="x-input x-border" type="date" name="">
			<b>Civil Status</b>
			<input class="x-input x-border" type="text" name="">
		</div>
	</div>
</div>

<div id="ls_modal" style="display: none;">
	<div id="ls_farmer" class="x-container" style="overflow-y:scroll;height: 60vh;">
		Loading
	</div>
</div>

<script type="text/javascript">
	var dd1, dd1_c
	
	$onload(function(){
		dd1_c = $ID('mem_modal_conts').innerHTML
		$ID('mem_modal_conts').innerHTML = ""
	},show_mem_modal)

	function show_mem_modal(){
		var mem_modal = $modal({
			title : "Add Farmer Member",
			type : "done",
			subtitle : "You are about to add a farmer from Profiling Form A to the selected FO",
			content : dd1_c
		})
		mem_modal.dialog.style.width = "80vw"
		mem_modal.show()
	}

	function search_profile(){
		var search_key = $ID('search_key').value
		alert('Click to continue searching ['+search_key+']')
		SPINNER_LOADER.show()
		$send({
			action : "/formb/search_farmer_profile",
			method : POST,
			err_dialog:true,
			data : $DATA({'search_item':search_key}),
			func : function (rest){
				var res_ = JSON.parse(rest)
				var out_dup = ""
				for (var x = 0; x < res_.length; x++) {
					out_dup +=(`
						<div class="x-row x-padding x-leftbar x-hover-border-green x-hover-pale-green">
							<div class='x-col m10 l10'>
								<b>`+res_[x]['Names']+`</b> |
								<span><span class='x-text-grey'>Address :</span> 
								R`+res_[x]['addr_region']+`, `+res_[x]['addr_prov']+`, `+res_[x]['addr_city']+`, `+res_[x]['addr_brgy']+` 
								</span> |
								<span><span class='x-text-grey'>Crop/Commodity :</span> 
								`+res_[x]['farmer_primary_crop']+`</span><br>
								&nbsp;
								<span><span class='x-text-grey'>reference :</span> 
								<i class='x-tiny'>`+res_[x]['reference']+`</i></span>
							</div>
							<div class='x-col m2 l2'>
								<button class='x-right x-btn x-green x-hover-black x-round-large' onclick="fill_selected_profile('`+res_[x]['db_id']+`','`+res_[x]['reference']+`')">
									<span class='fa fa-plus'></span>
								</button>
							</div>
						</div>
					`)
				}
				$ID('ls_farmer').innerHTML = out_dup
				var farmer_ls_modal = $dialog({
					title : "Search Results",
					subtitle : "Below are the list of search records result you may click one and the system will auto feel the fields (not editable)",
					content : $ID('ls_modal').innerHTML
				})
				farmer_ls_modal.show()
				SPINNER_LOADER.hide()
			},
			err : function(res){println(res)},
			progress : function(e){ 
				// var response_length = parseFloat(headerMap(e)['total'])
				var response_length = parseFloat(e.total)
				var response_loaded = parseFloat(e.loaded)
				var percent_  = (response_loaded / response_length) * 100;
				var percent_rounded = Math.round(percent_ * 100) / 100
				SPINNER_LOADER.loading(Math.round(percent_))
				SPINNER_LOADER.message(`
					<span>
						Gathering 
						<b>`+Math.round(percent_)+`%</b><br>
						<span class="x-small">
							[ `+(response_loaded/1000000).toFixed(1)+" / "+(response_length/1000000).toFixed(1)+` Mb ]<br>
							<i>`+(response_length-response_loaded)+` bytes remaining</i>
						</span>
					</span>
				`);
			}
		})

		function fill_selected_profile(db_id,ref_code){

		}
		// TABLE.ajax.url('/feature_0/filter_list_farmers')
		// TABLE.ajax.reload()
	}
</script>