<html>
<head>
	<!-- Required meta tags -->
	<meta charset="utf-890" lang="en-us">
	<script src="../../static/js/Brorn.min.js"></script> 
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="../../static/webrepstatic/css/style.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600&display=swap" rel="stylesheet">
	<!-- fontawesomeCDN -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<script src="../../static/webrepstatic/js/jquery.min.js"></script>
	<!-- <script type="text/javascript" src="../../static/webrepstatic/js/index.js"></script> -->

	<!-- CSS only -->
	<link href="../../static/webrepstatic/css/bootstrap.min.css" rel="stylesheet">


	<!-- JavaScript Bundle with Popper -->
	<script defer src="../../static/webrepstatic/js/bs@5.2.3/bootstrap.bundle.min.js"></script>
	<link href="https://transloadit.edgly.net/releases/uppy/v1.6.0/uppy.min.css" rel="stylesheet">
	<script src="https://transloadit.edgly.net/releases/uppy/v1.6.0/uppy.min.js"></script>

	<title >Create Article</title>
</head>

<body>

	{% include 'main/navbarpages.html' %}
<!-- Back Arrow -->
	<div class="container text-start mt-5">
		<a class=" texttheme" href="/rapid/admin/adminKnowledgeCenter.html">
			<span><i class="fa-solid fa-arrow-left-long"></i></span>
		</a>
	</div>

<!-- Title -->
	<div class="container d-flex justify-content-between text-start mt-5">
		<div class="">
			<h5 class="display-5 texttheme" >Create article</h5>
		</div>


		<div class="">
			<button class="btn btn-outline-success rounded-5" type="submit" data-bs-toggle="modal" data-bs-target="#createPostConfirmation" id="doneCreate"  onclick="submit_article()">Submit</a>
		</div>
	</div>


<!-- Arcticle News -->
	<div class="container shadow-sm p-3 bg-body rounded mb-5">
		<div class="container row">
			<div class="col-4 border-end border-light">
				<form class=" row g-3 needs-validation texttheme" id="form_for_createPost1" novalidate>
					<div class="col-md-12">
						<label for="postAuthor" class="form-label small fw-bolder">Author name</label>
						<input class="article_form form-control" id="postAuthor" value="{{user_data['name']}}" rows="3" placeholder=""></input>
						<div class="invalid-feedback">
							Please provide an Authur name.
						</div>
					</div>
					<div class="col-12">
						<label for="posttype" class="form-label small fw-bolder">Content</label>
						<select class="article_form form-select" id="posttype" required>
							<option>News</option>
							<option>Story</option>
							<option>Event</option>
						</select>
						<div class="invalid-feedback">
							Please select a Content.
						</div>
					</div>			
					<div class="col-12">
						<label for="Unit" class="form-label small fw-bolder">Category</label>
						<select class="article_form form-select" id="postCategory" required>
							<option>All</option>
							<option>Coffee</option>
							<option>Cacao</option>
							<option>Coconut</option>
							<option>Processed Fruits & Nuts</option>
						</select>
						<div class="invalid-feedback">
							Please select a Category.
						</div>
					</div>
					<div class="col-12">
						<label for="Unit" class="form-label small fw-bolder">RCU's</label>
						<select class="article_form form-select" id="postRcu" required>
							<option>NPCO</option>
							<option>RCU VIII</option>
							<option>RCU IX</option>
							<option>RCU X</option>
							<option>RCU XI</option>
							<option>RCU XII</option>
							<option>RCU XIII</option>
							<option>BARMM</option>
						</select>
						<div class="invalid-feedback">
							Please select a Category.
						</div>
					</div>
					<div class="col-12">
						<div style="display:none">
							<label for="postGA" class="form-label small fw-bolder">General Access</label>
							<select class="article_form form-select" id="postGA" required>
								<option>Only me</option>
								<option selected>Public</option>
								<option>Administrators</option>
							</select>
							<div class="invalid-feedback">
								Please select a General Access.
							</div>
						</div>
					</div>
					<div style="display:none">8
						<input class="article_form form-check-input" type="checkbox" id="sameName" value="" aria-label="sameName" checked>
						<span class="small fw-lighter ">check if author & publisher has the same name?</span>
					</div>
				</form>
			</div>
			<div class="col-8">
				<form class="row g-3 needs-validation texttheme" id="form_for_createPost2">
					<div class="col-md-12">
						<label for="postheader" class="form-label small fw-bolder">Create heading title</label>
						<input class="article_form form-control" id="postheader" rows="3"></input>
						<div class="invalid-feedback">
							Please provide heading title.
						</div>
					</div>

					<div class="col-md-12">
						<label for="postdescription" class="form-label small fw-bolder">Content description</label>
						<input class="article_form form-control" id="postdescription" rows="3"></input>
						<div class="invalid-feedback">
							Please provide heading title.
						</div>
					</div>

					<div class="col-12">
						<label for="postContent" class="form-label small fw-bolder">Add text content</label>
						<textarea class="article_form form-control" id="postContent" rows="3" style="height: 200px;"></textarea>
						<div class="invalid-feedback">
							Please provide a text content.
						</div>
					</div>

					<div class="col-12">
						<label for="postContent" class="form-label small fw-bolder">Upload cover photo</label>
						<input type="file" class="article_form form-control" name="file_name" id="file_name" accept="image/png, image/gif, image/jpeg, video/*" >

					</div>
					<div class="col-md-12">
						<label for="postcaption" class="form-label small fw-bolder">Photo caption</label>
						<input class="article_form form-control" id="postcaption" rows="3" placeholder="(e.g.,This is an example caption on this photo. Photo by Coco Martin.)"></input>
						<div class="invalid-feedback">
							Please provide an Authur name.
						</div>
					</div>
					<div class="col-md-12">
						<label for="posttags" class="form-label small fw-bolder">Tags:</label>
						<input class="article_form form-control" id="posttags" rows="3" placeholder="Coffee, Region XII, Coffee Event,"></input>
						<div class="invalid-feedback">
							Please provide an Authur name.
						</div>
					</div>
					<input type="" id="id" class="article_form" hidden>
				</form>
				<div class="mt-5">
					
				</div>
			</div>
		</div>
	</div>

	<!-- Article Confirmation modal -->
	<div class="modal " id="createPostConfirmation" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="exampleModalLabel">You're going there!</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body mb-3">
					<img src="https://img.freepik.com/free-vector/flat-composition-with-male-postman-letters-envelopes-vector-illustration_1284-67249.jpg?w=1380&t=st=1675837891~exp=1675838491~hmac=50c5f5bbe7f981071aa34e4c72806517b53911568ff8c26e7ebf2003c6d1eaa8" style="height:390px; width: 450px;">
					Your content needs to be reviewed by NPCO-assigned staff; <br>You will get a notification via email within a short period.
					<hr>
					<h3>Your Upload Process is</h3>
					<h2 id="upload_process"></h2>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Back</button>
					<button type="button" class="btn btn-primary" onclick="goto('/rapid/NewsAndStories/NewsAndStories.html')">Continue</button>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		function submit_article(){
			println(" * Posting Article")
			var data = {}; var from_field = $CLASS('article_form')
			for (var i = 0; i < from_field.length; i++) {
				if(from_field[i].type =="checkbox"){
					data[from_field[i].id] = from_field[i].checked
				}else{
					data[from_field[i].id] = web_safe_encode(from_field[i].value)
				}
			}
			$send({
				action : "/webrep/upload_file_webrep",
				method : POST,
				data : $DATA(data).appendFileArr($ID("file_name")),
				func : function(res){
					resp = JSON.parse(res)
					println(resp)
					// goto("/rapid/NewsAndStories/NewsAndStories.html")
				},
				err : function(res){alert(res)},
				progress : function(e){
					// var response_length = parseFloat(headerMap(e)['total'])
					println(e)
					var response_length = parseFloat(e.total)
					var response_loaded = parseFloat(e.loaded)
					var percent_  = (response_loaded / response_length) * 100;
					var percent_rounded = Math.round(percent_ * 100) / 100
					$ID("upload_process").innerHTML=(`
						<span>
							Gathering 
							<b>`+Math.round(percent_)+`%</b><br>
							<span class="x-small">
								[ `+(response_loaded/1000000).toFixed(1)+" / "+(response_length/1000000).toFixed(1)+` Mb ]<br>
								<i>`+(response_length-response_loaded)+` bytes remaining</i>
							</span>
						</span>
					`);
				}
			})
		}


		$onload(function(){
			$send({
				action : "/webrep/article/get_post_ind",
				method : POST,
				data : $DATA({"id":URL_ARGS['ids']}).appendFileArr($ID('file_name')),
				func : function(res){
					var resp = JSON.parse(res)[0]
					println(resp)
					var data = {}; var from_field = $CLASS('article_form')
					for (var i = 0; i < from_field.length; i++) {
						var _ID = from_field[i].id
						try{
							from_field[_ID].value = web_safe_decode(resp[_ID])
						}catch(e){}
					}
				}
			})
		})

	</script>
	{% include 'main/footer.html' %}

</body>
</html>