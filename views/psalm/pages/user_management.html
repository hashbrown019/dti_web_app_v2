<!-- Users Management Modal -->

<div class="modal fade" id="usermang" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-xl modal-dialog-scrollable" style="max-width: 80%;">
		<div class="modal-content">
			<div class="modal-header bg-light text-dark">
				<h1 class="modal-title " id="exampleModalLabel" >User Management</h1>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">x

				</button>
			</div>
			<div class="modal-body bg-light ">

				<div class=" ">
					<div class="row">

						<div class="col-4 border-end btn-default">
							<div class="container">
								<h5 class="font-weight-bold texttheme fs-2 mb-5">User List</h5>
								<div class="container overflow-auto" style="height: 60vh;" >											
									<table class="table">
										<thead>
											<tr>
												<th scope="col" class="texttheme">ID</th>
												<th scope="col" class="texttheme">Name</th>
											</tr>
										</thead>
										<tbody id="user_list" class="table-bordered">
											<tr>
												<th scope="row" class="texttheme">...</th>
												<td class="texttheme">Loading...</td>
											</tr>											    											   
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<div class="col-4 border-end btn-default">
							<div class="">
								<div class="d-flex justify-content-between">
									<div>
										<h5 class="font-weight-bold texttheme fs-2 ">Details</h5>													
									</div>
								</div>
								
								<div class="container mt-4 overflow-auto" style="height: 60vh;">
									<div class="mb-3" style="display: none;">													
										<h5 class="small font-weight-bold ms-1 texttheme">ID</h5>
										<input disabled class="USER_DATA form-control form-control " type="text" placeholder="" id="id">													
									</div>
									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Name</h5>
										<input class="USER_DATA form-control form-control" type="text" placeholder="" id="name">													
									</div>
									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Address</h5>
										<input class="USER_DATA form-control form-control" type="text" placeholder="" id="address">													
									</div>
									
									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Email Address:</h5>
										<input class="USER_DATA form-control form-control" type="email" placeholder="" id="email">													
									</div>

									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Job:</h5>
										<input class="USER_DATA form-control form-control" type="text" placeholder="" id="job">													
									</div>
									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Mobile:</h5>
										<input class="USER_DATA form-control form-control" type="text" placeholder="" id="mobile">													
									</div>
									<div class="row mb-3">						
										<div class="col-6">
											<h5 class="small font-weight-bold ms-1 texttheme">PCU:</h5>
											<input class="USER_DATA form-control form-control" type="text" placeholder="" id="pcu">	
											
										</div>	
										<div class="col-6">
											<h5 class="small font-weight-bold ms-1 texttheme">RCU:</h5>
											<input class="USER_DATA form-control form-control" type="text" placeholder="" id="rcu">														
										</div>						
									</div>
									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Username:</h5>
										<input class="USER_DATA form-control form-control" type="text" placeholder="" id="username">													
									</div>
									<!-- <div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Password:</h5>
										<input class="USER_DATA form-control form-control" type="text" placeholder="" id="password">													
									</div> -->
									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Date:</h5>
										<input class="USER_DATA form-control form-control" type="date" id="until">													
									</div>
									<!-- <div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Status:</h5>
										<select class="USER_DATA form-control form-control" id="status">
											<option>Active</option>
										</select>
										<input class="USER_DATA form-control form-control" type="text" placeholder="" id="status" disabled>													
									</div>	 -->											
								</div>

								<div class="mt-3">
									<div class="float-xl-right">
										<button id="chngpassbtn" type="button" class="btn btn-primary me-3" data-toggle="modal" data-target="#chngpass" onclick="$ID('')">Change Password</button>	
										<button type="button" class="btn btn-success me-3" onclick="save_user_det()">Save</button>	
									</div>
									<div class="float-xl-left">
										<button type="button" class="btn btn-warning me-3" onclick="clear_field()">Clear</button>	
									</div>
								</div>
							</div>
						</div>

						<div class="col-4">
							<div class="container">
								<div class="d-flex justify-content-between">
									<div>
										<h5 class="font-weight-bold texttheme fs-2 ">Setting</h5>													
									</div>												
								</div>
								<div class="mt-5">
									<p>Type:</p>
									<select class="form-control" aria-label="">
										<option value="">Super Admin</option>
										<option value="">Admin</option>
										<option value="">NPCO</option>
										<option value="">Default</option>
										<option value="">Guest</option>
									</select>
								</div>

								
								<div class="container mt-5 " style="height: 47vh;">
									<h5 class="font-weight-bold texttheme">Modules</h5>
									<table class="container table">
										<thead>
											<tr class=" ">
												<th scope="col" class="texttheme"></th>
												<th scope="col" class="texttheme">Read</th>
												<th scope="col" class="texttheme">Write</th>
												<th scope="col" class="texttheme">Update</th>
											</tr>
										</thead>
										<tbody class="table-bordered">
											{% for module in module_data: %}
												<tr>
													<td scope="row" class="texttheme">{{module['name']}}</td>
													<td class="texttheme">
														<div class="form-check ms-2">
															<input class="form-check-input" type="checkbox" value="" id="">
															<label class="form-check-label" for="check_write">
															</label>
														</div>
													</td>
													<td class="texttheme">
														<div class="form-check d-flex justify-content-center ">
															<input class="form-check-input" type="checkbox" value="" id="">
															<label class="form-check-label" for="check_write">
															</label>
														</div>
													</td>
													<td class="texttheme">
														<div class="form-check d-flex justify-content-center ">
															<input class="form-check-input" type="checkbox" value="" id="">
															<label class="form-check-label" for="check_write">
															</label>
														</div>
													</td>
												</tr>
											{% endfor %}										    											   
										</tbody>
									</table>
								</div>
								<!-- <div class="d-flex ">
									<div>
										<button type="button" class="btn btn-primary me-3">Save</i></button>	
									</div>
								</div> -->
							</div>
						</div>
					</div>
				</div>


			</div>
			<div class="modal-footer">
				
			</div>
		</div>
	</div>
</div>


<div class="modal fade" id="chngpass" tabindex="-1" aria-labelledby="exampleModalLabel2" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable" style="max-width: 50%;">
        <div class="modal-content">
            <div class="modal-header bg-light text-dark">
                <h1 class="modal-title" id="exampleModalLabel">Change Password</h1>
                <button id="changebtnclose" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body bg-light ">

				<div class=" ">
					<div class="row">
		
								
								<div class="container mt-4 overflow-auto">
								
									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Current Password</h5>
										<input class="form-control form-control" type="password" placeholder="" id="currpass">													
									</div>

									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">New Password</h5>
										<input class="form-control form-control" type="password" placeholder="" id="newpass">													
									</div>

									<div class="mb-3">													
										<h5 class="small font-weight-bold ms-1 texttheme">Confirm New Password</h5>
										<input class="form-control form-control" type="password" placeholder="" id="confpass">													
									</div>

									<div class="mt-3">
										<div class="float-xl-right">
											<button id="resetpass" type="button" class="btn btn-info me-3">Reset Password</button>	
											<button type="button" class="btn btn-secondary me-3" class="close" data-dismiss="modal" aria-label="Close">Cancel</button>	
										</div>
							
									</div>
																			
								</div>

							</div>
						</div>



			</div>


        </div>
    </div>
</div>
<style>
	.modal {
  /* Other modal styles */
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 9999;
}

.blur {
  filter: blur(3px);
  transition: all 0.3s ease-in-out;
}
</style>

<script type="text/javascript" src="../../static/js/Brorn.min.js"></script>
<script type="text/javascript">
	$onload(function(){
		$ID('userbtn').addEventListener("click",function(e){
			get_user_data()
		})
	})

	function clear_field(){
		var user_data_ = $CLASS('USER_DATA')
		for (var i = 0; i < user_data_.length; i++) {
			user_data_[i].value = ""
		}
	}

	function save_user_det(){
		var user_data_ = $CLASS('USER_DATA')
		var user_info = {}
		for (var i = 0; i < user_data_.length; i++) {
			user_info[user_data_[i].id] = user_data_[i].value
		}
		println(user_info)
		$send({
			action : "/api/edit_user",
			data : $DATA(user_info),
			err_dialog : true,
			method : POST,
			func : function(r){
				set_user_datafield(user_info['id'])
				get_user_data()
			} 
		})
	}

	function get_user_data(){
		$send({
			action : "/api/get_user_data/all",
			func : function(r){
				var resp = JSON.parse(r)
				var ls_str = ""
				for (var i = 0; i < resp.length; i++) {
					ls_str += (`
						<tr onclick="set_user_datafield(`+resp[i]['id']+`)">
							<th scope="row" class="texttheme">`+resp[i]['id']+`</th>
							<td class="texttheme">`+resp[i]['name']+`</td>
						</tr>		
					`)
				}
				$ID('user_list').innerHTML = ls_str
			}
		})
	}

	function set_user_datafield(arr){
		$send({
			action : "/api/get_user_data/"+arr,
			err_dialog : true,
			func : function(r){
				var resp = JSON.parse(r)[0]
				println(resp)
				var USER_DATA = $CLASS('USER_DATA')
				for (var i = 0; i < USER_DATA.length; i++) {
					if(USER_DATA[i].id == "until"){
						// var DDATE = new Date(resp[USER_DATA[i].id])
						USER_DATA[i].value = resp[USER_DATA[i].id]
						// println(resp[USER_DATA[i].id])
						// println(typeof(resp[USER_DATA[i].id]))
					}else{
						USER_DATA[i].value = resp[USER_DATA[i].id]
					}

				}
			}
		})
	}

$(document).ready(function() {
  $("#chngpassbtn").click(function() {
    $("#chngpass").modal('show');
    $("#usermang").addClass("blur");
  });

  $("#chngpass").on('hidden.bs.modal', function () {
    $("#usermang").removeClass("blur");
  });
});



const newPasswordInput = $("#newpass");
const confirmPassInput = $("#confpass");
const changePassButton = $("#resetpass");
const validationMessage = $("#validation-message");

newPasswordInput.on("input", validatePasswordMatch);
confirmPassInput.on("input", validatePasswordMatch);

function validatePasswordMatch() {
  const newPassword = newPasswordInput.val();
  const confirmPass = confirmPassInput.val();
  const isValid = newPassword === confirmPass && newPassword.length > 0;
  
  if (isValid) {
    confirmPassInput[0].setCustomValidity("");
    confirmPassInput.removeClass("is-invalid").addClass("is-valid");
    validationMessage.hide();
  } else {
    confirmPassInput[0].setCustomValidity("Passwords do not match");
    confirmPassInput.removeClass("is-valid").addClass("is-invalid");
    validationMessage.show();
  }
  
  changePassButton.prop("disabled", !isValid);
}
</script>