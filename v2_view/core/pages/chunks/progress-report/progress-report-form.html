  <div class="wide-container py-4">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="card-header text-white bg-teal">
            <h5 class="mb-0 fs-5">Narrative Progress Report</h5>
          </div>
          <br>
        <div class="card shadow">
          <div class="card-body">

            <!-- General Activity Information Section -->
            <section class="form-section">
              <div class="row g-3">
                <div class="col-md-4">
                  <label for="implementing-unit" class="form-label">Implementing Unit:</label>
                  <select id="implementing-unit" name="implementing_unit" class="form-select PROGRESS_REPORT_FORM" required>
                      <option value="">Choose your option</option>

                      <optgroup label="RCU">
                          <option value="RCU 8 - Eastern Visayas">RCU 8 - - Eastern Visayas</option>
                          <option value="RCU 9 - Zamboanga Peninsula">RCU 9 - Zamboanga Peninsula</option>
                          <option value="RCU 10 - Northern Mindanao">RCU 10 - Northern Mindanao</option>
                          <option value="RCU 11 - Davao Region">RCU 11 - Davao Region</option>
                          <option value="RCU 12 - SOCCSKSARGEN">RCU 12 - SOCCSKSARGEN</option>
                          <option value="RCU 13 - Caraga">RCU 13  - Caraga</option>
                          <option value="BARMM">BARMM</option>
                      </optgroup>

                      <optgroup label="PCU">
                          <option value="PCU - Northern Samar">PCU - Northern Samar</option>
                          <option value="PCU - Leyte">PCU - Leyte</option>
                          <option value="PCU - Southern Leyte">PCU - Southern Leyte</option>
                          <option value="PCU - Zamboanga del Norte">PCU - Zamboanga del Norte</option>
                          <option value="PCU - Zamboanga Sibugay">PCU - Zamboanga Sibugay</option>
                          <option value="PCU - Zamboanga del Sur">PCU - Zamboanga del Sur</option>
                          <option value="PCU - Misamis Oriental">PCU - Misamis Oriental</option>
                          <option value="PCU - Bukidnon">PCU - Bukidnon</option>
                          <option value="PCU - Lanao del Norte">PCU - Lanao del Norte</option>
                          <option value="PCU - Davao de Oro">PCU - Davao de Oro</option>
                          <option value="PCU - Davao Oriental">PCU - Davao Oriental</option>
                          <option value="PCU - Davao del Norte">PCU - Davao del Norte</option>
                          <option value="PCU - Davao del Sur">PCU - Davao del Sur</option>
                          <option value="PCU - Davao Occidental">PCU - Davao Occidental</option>
                          <option value="PCU - North Cotabato">PCU - North Cotabato</option>
                          <option value="PCU - Sultan Kudarat">PCU - Sultan Kudarat</option>
                          <option value="PCU - Sarangani">PCU - Sarangani</option>
                          <option value="PCU - Agusan del Norte">PCU - Agusan del Norte</option>
                          <option value="PCU - Agusan del Sur">PCU - Agusan del Sur</option>
                          <option value="PCU - Surigao del Sur">PCU - Surigao del Sur</option>
                          <option value="PCU - Maguindanao">PCU - Maguindanao</option>
                      </optgroup>
                  </select>
              </div>

                <div class="col-md-4">
                  <label for="logframe-indicators" class="form-label">Alignment with Logframe Indicator:</label>
                  <select class="form-select PROGRESS_REPORT_FORM" id="logframe_indicators" required>
                    <option value="">Choose your option</option>
                    <option value="1.a - Percentage increase in value of sales of participating MSMEs, Farmers Associations and Cooperatives">
                      1.a - Percentage increase in value of sales of participating MSMEs, Farmers Associations and Cooperatives
                    </option>
                    <option value="1.b - No. of commercial partnerships developed between farmers cooperatives and SMEs/large corporations">
                      1.b - No. of commercial partnerships developed between farmers cooperatives and SMEs/large corporations
                    </option>
                    <option value="1.1.a - Number of networks of Negosyo Centers set up servicing farmers, farmers associations, cooperatives and MSMEs in 21 provinces">
                      1.1.a - Number of networks of Negosyo Centers set up servicing farmers, farmers associations, cooperatives and MSMEs in 21 provinces
                    </option>
                    <option value="1.1.b - Number of FAs/coops served">1.1.b - Number of FAs/coops served</option>
                    <option value="1.1.c - Number of MSMEs served">1.1.c - Number of MSMEs served</option>
                    <option value="1.2.a - Number of pool of qualified service providers set up per province">
                      1.2.a - Number of pool of qualified service providers set up per province
                    </option>
                    <option value="1.3.a - Number of farmers trained, disaggregated as men, women, IP and youth">
                      1.3.a - Number of farmers trained, disaggregated as men, women, IP and youth
                    </option>
                    <option value="1.3.b - Number of FAs/cooperatives trained">1.3.b - Number of FAs/cooperatives trained</option>
                    <option value="1.3.c - Number of MEs trained">1.3.c - Number of MEs trained</option>
                    <option value="1.4.a - Number of Detailed Investment Plans (DIPs) developed">
                      1.4.a - Number of Detailed Investment Plans (DIPs) developed
                    </option>
                    <option value="1.4.b - Number of farming households participate in Detailed Investment Plans (DIPs)">
                      1.4.b - Number of farming households participate in Detailed Investment Plans (DIPs)
                    </option>
                    <option value="1.4.c - Number of partnership agreements entered into by FAs/ Coops, MSMEs or large enterprises">
                      1.4.c - Number of partnership agreements entered into by FAs/ Coops, MSMEs or large enterprises
                    </option>
                    <option value="1.5.a - Number of functional industry councils in selected value chain commodities">
                      1.5.a - Number of functional industry councils in selected value chain commodities
                    </option>
                    <option value="1.5.b - Number of DTI/NCs and LGUs Staff trained, disaggregated as men, women, IP, youth">
                      1.5.b - Number of DTI/NCs and LGUs Staff trained, disaggregated as men, women, IP, youth
                    </option>
                    <option value="1.6.a - Number of industry-based MIS, accessible to value chain stakeholders, running and regularly updated">
                      1.6.a - Number of industry-based MIS, accessible to value chain stakeholders, running and regularly updated
                    </option>
                    <option value="2.a - Number of Farming HH established linkage with markets, and availed financial services for productive investments">
                      2.a - Number of Farming HH established linkage with markets, and availed financial services for productive investments
                    </option>
                    <option value="2.b - Number of MSMEs established linkage with producers/farmers, markets, and availed financial services for productive investments">
                      2.b - Number of MSMEs established linkage with producers/farmers, markets, and availed financial services for productive investments
                    </option>
                    <option value="2.c - % increase in productivity of participating SMEs and Cooperatives">
                      2.c - % increase in productivity of participating SMEs and Cooperatives
                    </option>
                    <option value="2.d - % increase in volume and value of sales at farm/coop level and SME level">
                      2.d - % increase in volume and value of sales at farm/coop level and SME level
                    </option>
                    <option value="2.1.a - Number of products form/types conformed to market requirements">
                      2.1.a - Number of products form/types conformed to market requirements
                    </option>
                    <option value="2.2.a - Number of market linkages established">2.2.a - Number of market linkages established</option>
                    <option value="2.3.a - Number of FSPs extend innovative and other value-chain financial services">
                      2.3.a - Number of FSPs extend innovative and other value-chain financial services
                    </option>
                    <option value="2.3.b - Number of suitable financial products developed">
                      2.3.b - Number of suitable financial products developed
                    </option>
                    <option value="2.3.c - Number of linkages to financial services established">
                      2.3.c - Number of linkages to financial services established
                    </option>
                    <option value="2.3.d - Target number of enterprises benefitting from equity financing">
                      2.3.d - Target number of enterprises benefitting from equity financing
                    </option>
                    <option value="2.4.a - Length of farm-to-market road rehabilitated and maintained (in km)">
                      2.4.a - Length of farm-to-market road rehabilitated and maintained (in km)
                    </option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label for="awpb-indicators" class="form-label">Alignment with AWPB Key Indicator:</label>
                  <select class="form-select PROGRESS_REPORT_FORM" id="awpb_indicators" required>
                    <option value="">Choose your option</option>
                    <option value="1.1.1.1 Number of qualified BDS providers engaged">
                      1.1.1.1 Number of qualified BDS providers engaged
                    </option>
                    <option value="1.1.2.1 Number of Smallholder Farmer Households Profiled">
                      1.1.2.1 Number of Smallholder Farmer Households Profiled
                    </option>
                    <option value="1.1.2.2 Number of FOs profiled">1.1.2.2 Number of FOs profiled</option>
                    <option value="1.1.2.3 Number of MSMEs profiled">1.1.2.3 Number of MSMEs profiled</option>
                    <option value="1.1.3.1 Number of capacity building activities conducted">
                      1.1.3.1 Number of capacity building activities conducted
                    </option>
                    <option value="1.1.4.1 Number of product development assistance provided">
                      1.1.4.1 Number of product development assistance provided
                    </option>
                    <option value="1.1.4.2 Number of products/systems (e.g. digital processes) developed /improved">
                      1.1.4.2 Number of products/systems (e.g. digital processes) developed /improved
                    </option>
                    <option value="1.1.4.3 Number of firm level productivity and quality standards consultancy services provided">
                      1.1.4.3 Number of firm level productivity and quality standards consultancy services provided
                    </option>
                    <option value="1.1.5.1 Number of trade promotions activities organized/participated">
                      1.1.5.1 Number of trade promotions activities organized/participated
                    </option>
                    <option value="1.1.5.3 Number of firms/MSMEs/FOs that have received quality and trade-related certifications">
                      1.1.5.3 Number of firms/MSMEs/FOs that have received quality and trade-related certifications
                    </option>
                    <option value="1.1.5.4 Number of products certified">1.1.5.4 Number of products certified</option>
                    <option value="1.2.1.1 Number of approved DIPs">1.2.1.1 Number of approved DIPs</option>
                    <option value="1.2.2.1 Number of MGRRs approved">1.2.2.1 Number of MGRRs approved</option>
                    <option value="1.2.2.2 Number of MG funds (MGRRs) support received by FOs and MSMEs">
                      1.2.2.2 Number of MG funds (MGRRs) support received by FOs and MSMEs
                    </option>
                    <option value="1.2.2.3 Number of Smallholder Farmers received the MG inputs/tools">
                      1.2.2.3 Number of Smallholder Farmers received the MG inputs/tools
                    </option>
                    <option value="1.2.2.4 Number of Firms, FOs/MSMEs received MG Assistance">
                      1.2.2.4 Number of Firms, FOs/MSMEs received MG Assistance
                    </option>
                    <option value="1.2.2.5 Number of farms rehabilitated (In Number of hectares)">
                      1.2.2.5 Number of farms rehabilitated (In Number of hectares)
                    </option>
                    <option value="1.2.2.6 Number of expansion areas (in Number of hectares)">
                      1.2.2.6 Number of expansion areas (in Number of hectares)
                    </option>
                    <option value="1.3.1.1 length of road rehabilitated/ covered (in km)">
                      1.3.1.1 length of road rehabilitated/ covered (in km)
                    </option>
                    <option value="2.1.1.1 Number of Commercial Partnership Agreements signed">
                      2.1.1.1 Number of Commercial Partnership Agreements signed
                    </option>
                    <option value="2.1.2.1 Number of Industry Studies Prepared">2.1.2.1 Number of Industry Studies Prepared</option>
                    <option value="2.1.3.1 Number of RAPID assisted/participated/sponsored industry-organized congress/ conferences, events,meetings,and capbuild activities">
                      2.1.3.1 Number of RAPID assisted/participated/sponsored industry-organized congress/ conferences, events,meetings,and capbuild activities
                    </option>
                    <option value="2.1.3.2 Number of resolutions/Policy Recoms passed by RTWGs">
                      2.1.3.2 Number of resolutions/Policy Recoms passed by RTWGs
                    </option>
                    <option value="3.1.1.1 Number of MSMEs availed of Financial Services">
                      3.1.1.1 Number of MSMEs availed of Financial Services
                    </option>
                    <option value="3.1.1.2 Number of FOs availed Financial Service">3.1.1.2 Number of FOs availed Financial Service</option>
                    <option value="3.1.1.3 Number of Farming Households availed Finacial Services">
                      3.1.1.3 Number of Farming Households availed Finacial Services
                    </option>
                    <option value="3.1.1.4 Number of FSPs extend suitable VC Finacial Services">
                      3.1.1.4 Number of FSPs extend suitable VC Finacial Services
                    </option>
                    <option value="3.1.1.5 Number of Suitable FInancial Products Developed">
                      3.1.1.5 Number of Suitable FInancial Products Developed
                    </option>
                    <option value="3.1.1.6 Number of Financing related activities conducted">
                      3.1.1.6 Number of Financing related activities conducted
                    </option>
                    <option value="3.1.1.7 Number of FOs Link to Financial Services Established">
                      3.1.1.7 Number of FOs Link to Financial Services Established
                    </option>
                    <option value="3.1.1.8 Number of MSME Link to Financial Services Established">
                      3.1.1.8 Number of MSME Link to Financial Services Established
                    </option>
                    <option value="4.1.1.1 Number of Firms availed of Financing Services through SBC's equity financing">
                      4.1.1.1 Number of Firms availed of Financing Services through SBC's equity financing
                    </option>
                    <option value="4.1.1.2 Number of Info Campaigns/Orientation/ Conducted by SBC">
                      4.1.1.2 Number of Info Campaigns/Orientation/ Conducted by SBC
                    </option>
                    <option value="5.1.1.1 Number of Project Staff Hired">5.1.1.1 Number of Project Staff Hired</option>
                    <option value="5.1.1.2 Number of plans, policies/guidelines, and manuals prepared/ updated">
                      5.1.1.2 Number of plans, policies/guidelines, and manuals prepared/ updated
                    </option>
                    <option value="5.2.1.1 Number of Capacity Building/enhancement initiatives provided for RAPID staff, DTI organic staff, and Negosyo Center Business Counselors">
                      5.2.1.1 Number of Capacity Building/enhancement initiatives provided for RAPID staff, DTI organic staff, and Negosyo Center Business Counselors
                    </option>
                    <option value="5.3.1.1 Number of Coordination meeting conducted">
                      5.3.1.1 Number of Coordination meeting conducted
                    </option>
                    <option value="5.3.1.2 Number of Program Networking Activities participated">
                      5.3.1.2 Number of Program Networking Activities participated
                    </option>
                    <option value="5.4.1.1 MIS established and updated">5.4.1.1 MIS established and updated</option>
                    <option value="5.4.1.2 Number of M&E Activities initated/facilitated">
                      5.4.1.2 Number of M&E Activities initated/facilitated
                    </option>
                    <option value="5.4.1.3 Number of Reports Submitted">5.4.1.3 Number of Reports Submitted</option>
                    <option value="5.4.2.1 Number of KM materials prepared, updated, and disseminated">
                      5.4.2.1 Number of KM materials prepared, updated, and disseminated
                    </option>
                    <option value="5.5.1.1 Number of GESI and SECAP activities/projects initiated/coordinated">
                      5.5.1.1 Number of GESI and SECAP activities/projects initiated/coordinated
                    </option>
                    <option value="5.6.1.1 Number of Regional SOE Submitted">
                      5.6.1.1 Number of Regional SOE Submitted
                    </option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label for="activity-month" class="form-label">Month Reported:</label>
                  <select class="form-select PROGRESS_REPORT_FORM" id="activity_month" required>
                    <option value="" selected disabled>Select month</option>
                    <option>January</option><option>February</option><option>March</option>
                    <option>April</option><option>May</option><option>June</option>
                    <option>July</option><option>August</option><option>September</option>
                    <option>October</option><option>November</option><option>December</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="start-date" class="form-label">Start Date of Activity:</label>
                  <input type="date" class="form-control PROGRESS_REPORT_FORM" id="start_date" required>
                </div>
                <div class="col-md-4">
                  <label for="end-date" class="form-label">End Date of Activity:</label>
                  <input type="date" class="form-control PROGRESS_REPORT_FORM" id="end_date" required>
                </div>
              </div>
            </section>

            <!-- Divider -->
            <div class="section-divider">Activity Details</div>

            <section class="form-section">
              <div class="row">
                <!-- Left Column (Activity Details) -->
                <div class="col-lg-6 px-3"> <!-- Added horizontal padding -->
                  <div class="row g-2">
                    <!-- Activity Fields -->
                    <div class="col-md-6">
                      <label for="activity-title" class="form-label">Title of the Activity:</label>
                      <input type="text" class="form-control PROGRESS_REPORT_FORM" id="activity_title" required>
                    </div>
                    <div class="col-md-6">
                      <label for="stakeholders" class="form-label">Involved Key Stakeholders/Participants:</label>
                      <select class="form-select PROGRESS_REPORT_FORM" id="stakeholders" required>
                        <option value="">Choose your option</option>
                        <option value="Small Holder Farmers (SHFs)">Small Holder Farmers (SHFs)</option>
                        <option value="Farmer Organizations (FOs)">Farmer Organizations (FOs)</option>
                        <option value="MSMEs">MSMEs</option>
                        <option value="LGU">LGU</option>
                        <option value="RAPID Project Staff">RAPID Project Staff</option>
                        <option value="Industry Stakeholders">Industry Stakeholders</option>
                        <option value="FSPs">FSPs</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="industry" class="form-label">Industry/Commodity:</label>
                      <select class="form-select PROGRESS_REPORT_FORM" id="industry" required>
                        <option value="N/A">N/A</option>
                        <option value="Coffee">Coffee</option>
                        <option value="Cacao">Cacao</option>
                        <option value="Coconut">Coconut</option>
                        <option value="Banana Cardava">Banana Cardava</option>
                        <option value="Calamansi">Calamansi</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="approved-budget" class="form-label">Approved Budget (₱):</label>
                      <input type="number" class="form-control PROGRESS_REPORT_FORM" id="approved_budget" required>
                    </div>
                    <div class="col-md-6">
                      <label for="venue" class="form-label">Venue of the Activity:</label>
                      <input type="text" class="form-control PROGRESS_REPORT_FORM" id="venue" required>
                    </div>
                    <div class="col-md-6">
                      <label for="actual-budget" class="form-label">Actual Budget Spent (₱):</label>
                      <input type="number" class="form-control PROGRESS_REPORT_FORM" id="actual_budget" required>
                    </div>
                  </div>
                </div>

                <!-- Right Column (Participants + Other Partners) -->
                <div class="col-lg-6 px-3"> <!-- Added horizontal padding -->
                  <div class="row g-2">
                    <!-- Participant Inputs -->
                    <div class="col-md-6">
                      <label for="male-participants" class="form-label">Male Participants:</label>
                      <input type="number" class="form-control PROGRESS_REPORT_FORM" id="male_participants" min="0" required>
                    </div>
                    <div class="col-md-6">
                      <label for="female-participants" class="form-label">Female Participants:</label>
                      <input type="number" class="form-control PROGRESS_REPORT_FORM" id="female_participants" min="0" required>
                    </div>
                    <div class="col-md-6">
                      <label for="ip-participants" class="form-label">IP Participants:</label>
                      <input type="number" class="form-control PROGRESS_REPORT_FORM" id="ip_participants" min="0" required>
                    </div>
                    <div class="col-md-6">
                      <label for="youth-participants" class="form-label">Youth Participants:</label>
                      <input type="number" class="form-control PROGRESS_REPORT_FORM" id="youth_participants" min="0" required>
                    </div>
                  </div>

                  <!-- Other Partners -->
                  <div class="mt-3">
                    <label for="other-partners" class="form-label">Other Partners Involved in the Conduct of Activity:</label>
                    <textarea class="form-control PROGRESS_REPORT_FORM" id="other_partners" rows="3"
                      placeholder="Indicate the full name of the partner organization implementing the activity"
                      required></textarea>
                  </div>
                </div>
              </div>
            </section>

            <!-- Divider -->
            <div class="section-divider">Narrative and Accomplishment Details</div>

            <section class="form-section">
              <div class="row g-3">
                <div class="col-md-12">
                  <label for="objectives-output" class="form-label">Objectives and Expected Output/s of the Activity:</label>
                  <textarea class="form-control PROGRESS_REPORT_FORM" id="objectives_output" rows="3" required></textarea>
                </div>
                <div class="col-md-12">
                  <label for="major-highlights" class="form-label">Major Highlights:</label>
                  <textarea class="form-control PROGRESS_REPORT_FORM" id="major_highlights" rows="3" required></textarea>
                </div>
                <div class="col-md-6">
                  <label for="awpb-accomplishments" class="form-label">AWPB Accomplishments/Progress per AWPB Indicator (vis-à-vis alignment with AWPB Key Indicator):</label>
                  <input type="number" class="form-control PROGRESS_REPORT_FORM" id="awpb_accomplishments" required>
                </div>
              </div>
            </section>

            <section class="form-section">
              <div class="table-responsive">
                <table class="table table-bordered align-middle">
                  <thead class="custom-table-header text-center">
                    <tr>
                      <th style="width: 33%;">Challenges</th>
                      <th style="width: 33%;">Lesson Learned / Plan of Action</th>
                      <th style="width: 34%;">Emerging Good Practices</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><textarea class="form-control PROGRESS_REPORT_FORM" id="challenges" rows="4" required></textarea></td>
                      <td><textarea class="form-control PROGRESS_REPORT_FORM" id="lesson_learned_plan_action" rows="4" required></textarea></td>
                      <td><textarea class="form-control PROGRESS_REPORT_FORM" id="emerging_good_practices" rows="4" required></textarea></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>

            <!-- MIS Encoding and Photo Reports Section -->
            <div class="row g-3 mt-3">
              <div class="col-md-6">
                <label for="mis-encoding" class="form-label">Encoding in the MIS-DCF:</label>
                <select class="form-select PROGRESS_REPORT_FORM" id="mis_encoding">
                  <option value="">Choose your option</option>
                  <option value="DCF 1 - DIP Preparation">DCF 1 - DIP Preparation</option>
                  <option value="DCF 2 - CPA Tracker">DCF 2 - CPA Tracker</option>
                  <option value="DCF 3 - BDSP">DCF 3 - BDSP</option>
                  <option value="DCF 4 - CapBuild Tracker">DCF 4 - CapBuild Tracker</option>
                  <option value="DCF 5 - Matching Grant">DCF 5 - Matching Grant</option>
                  <option value="DCF 6 - Product Development">DCF 6 - Product Development</option>
                  <option value="DCF 7 - Trade Promotions">DCF 7 - Trade Promotions</option>
                  <option value="DCF 8 - FMI">DCF 8 - FMI</option>
                  <option value="DCF 9 - Enablers Activity">DCF 9 - Enablers Activity</option>
                  <option value="DCF 10 - Negosyo Center">DCF 10 - Negosyo Center</option>
                  <option value="DCF 11 - Access to Finance">DCF 11 - Access to Finance</option>
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label">Means of Verification (MOV's | select "None" if no mov uploaded):</label>
                <div class="input-group">
                  <button type="button" class="btn btn-outline-secondary" id="upload_btn" style="margin-right: 8px;" onclick="window.open('https://drive.google.com/drive/folders/1jLhT5AULybBjAyAGIN49WNccjQHhpQxx', '_blank')">Upload Here</button>
                  <select class="form-select PROGRESS_REPORT_FORM" id="upload_status" style="max-width: 120px;">
                    <option value="none">None</option>
                    <option value="uploaded">Uploaded</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-end">
              <button type="button" class="btn btn-primary" style="background-color: #096272; border: #096272;" onclick="submit_progress_report()">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<input type="hidden" id="upload_by" class="PROGRESS_REPORT_FORM" value="">

<script>
let loggedInUserId = null;

async function fetchLoggedInUser() {
    try {
        const sessionRes = await fetch("/mis-v4/get-session");
        const sessionData = await sessionRes.json();
        if (sessionData && sessionData[0] && sessionData[0].id) {
            loggedInUserId = Number(sessionData[0].id);
            const createdByField = document.getElementById("upload_by");
            if (createdByField) createdByField.value = loggedInUserId;
        }
    } catch (e) {
        console.error("Error fetching session:", e);
    }
}
fetchLoggedInUser();

async function submit_progress_report() {
    const formElements = document.querySelectorAll(".PROGRESS_REPORT_FORM");
    let isValid = true;
    formElements.forEach(el => {
        if (el.hasAttribute("required") && !el.value.trim()) {
            el.style.border = "2px solid red";
            isValid = false;
        } else {
            el.style.border = "2px solid #c2bfbf"; // Default border
        }
    });

    if (!isValid) {
        Swal.fire({
            icon: "warning",
            title: "Incomplete Form",
            text: "Please fill out all required fields before submitting."
        });
        return;
    }
    let formData = new FormData();
    formElements.forEach(el => {
        const key = el.name || el.id;
        if (key) {
            formData.append(key, el.value.trim());
        }
    });

    if (!formData.get("upload_by") && loggedInUserId) {
        formData.set("upload_by", loggedInUserId);
    }

    try {

        const res = await fetch("/insert/progress_report", {
            method: "POST",
            body: formData
        });
        const result = await res.json();

        if (
            result?.status === "success" ||
            result?.success === true ||
            result === true ||
            (result?.affected_rows && Number(result.affected_rows) > 0) || 
            (typeof result === "number" && result > 0) 
        ) {
            Swal.fire({
                icon: "success",
                title: "Report Submitted!",
                text: "Your Progress Report has been successfully saved.",
                showConfirmButton: false,
                timer: 2000
            });

            document.querySelectorAll('.PROGRESS_REPORT_FORM').forEach(el => {
                if (el.id !== "upload_by") {
                    el.value = "";
                }
            });
        } else {
            Swal.fire({
                icon: "error",
                title: "Error!",
                text: result.message || "Something went wrong while saving the report."
            });
        }
    } catch (error) {
        console.error("Error submitting report:", error);
        Swal.fire({
            icon: "error",
            title: "Request Failed",
            text: "Unable to connect to the server. Please try again later.",
            confirmButtonText: "OK"
        });
    }
}
</script>